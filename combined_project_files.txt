
--- START FILE: .gitignore ---

# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
package-lock.json

--- END FILE: .gitignore ---

--- START FILE: eslint.config.mjs ---

import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";

const eslintConfig = defineConfig([
  ...nextVitals,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;


--- END FILE: eslint.config.mjs ---

--- START FILE: jsconfig.json ---

{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}


--- END FILE: jsconfig.json ---

--- START FILE: next.config.mjs ---

/** @type {import('next').NextConfig} */
const nextConfig = {
  /* config options here */
  
  // FIX: Necessary for Next.js to process CSS imports inside node_modules/react-pdf
  transpilePackages: ['react-pdf'],
};

export default nextConfig;

--- END FILE: next.config.mjs ---

--- START FILE: package.json ---

{
  "name": "anandayoga-center",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "firebase": "^12.7.0",
    "next": "16.1.0",
    "pdfjs-dist": "^5.4.449",
    "razorpay": "^2.9.6",
    "react": "19.2.3",
    "react-dom": "19.2.3",
    "react-pdf": "^10.2.0",
    "swr": "^2.3.8"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "eslint": "^9",
    "eslint-config-next": "16.1.0",
    "tailwindcss": "^4"
  }
}


--- END FILE: package.json ---

--- START FILE: postcss.config.mjs ---

const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;


--- END FILE: postcss.config.mjs ---

--- START FILE: public\file.svg ---

<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>

--- END FILE: public\file.svg ---

--- START FILE: public\globe.svg ---

<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>

--- END FILE: public\globe.svg ---

--- START FILE: public\next.svg ---

<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>

--- END FILE: public\next.svg ---

--- START FILE: public\vercel.svg ---

<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>

--- END FILE: public\vercel.svg ---

--- START FILE: public\window.svg ---

<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>

--- END FILE: public\window.svg ---

--- START FILE: src\app\globals.css ---

/* 
 * FIX for Tailwind CSS v4: 
 * Use the single @import "tailwindcss" directive. 
 */
@import "tailwindcss";


/* --- Custom Visual Enhancement: Fonts and Colors --- */

/* Assume fonts Playfair Display (Serif) & Inter (Sans) are linked */
@layer base {
  .font-serif {
    font-family: 'Playfair Display', Georgia, serif; 
  }
  .font-sans {
    font-family: 'Inter', system-ui, sans-serif;
  }

  /* Base Body Styling: Uses the custom variable background/foreground */
  body {
    background: rgb(var(--bg-base)); 
    color: rgb(var(--text-base));
    font-family: 'Inter', system-ui, sans-serif; 
    -webkit-font-smoothing: antialiased;
    transition: background-color 0.3s, color 0.3s; /* Smooth transition */
  }
  
  /* FIX 2 (CRITICAL): Force the root element background to follow the theme class */
  .light {
    background-color: rgb(var(--bg-base));
  }
}

@layer components {
    /* Define the Serene Gradient using the new primary colors */
    .bg-serene-gradient {
        background-image: linear-gradient(135deg, 
            /* FIX: Changed rgba(..., 0.9) to rgb(...) to make the gradient itself fully opaque. */
            rgb(var(--brand-primary)) 0%, 
            /* FIX: Changed rgba(..., 0.8) to rgb(...) to make the gradient itself fully opaque. */
            rgb(var(--brand-primary-light)) 100%
        );
    }
}

@layer utilities {
    /* Mapped custom utilities for background colors */
    .bg-surface-1 { background-color: rgb(var(--bg-surface-1)); }
    .bg-surface-2 { background-color: rgb(var(--bg-surface-2)); }
    .bg-brand-primary { background-color: rgb(var(--brand-primary)); }
    .bg-brand-accent { background-color: rgb(var(--brand-accent)); }
    .bg-brand-primary-light { background-color: rgb(var(--brand-primary-light)); }


    /* Mapped custom utilities for text colors */
    .text-brand-primary { color: rgb(var(--brand-primary)); }
    .text-brand-accent { color: rgb(var(--brand-accent)); }
    .text-text-base { color: rgb(var(--text-base)); }
    .text-surface-muted { color: rgb(var(--text-muted)); }

    /* Mapped custom utilities for status colors */
    .text-status-success { color: rgb(var(--status-success)); }
    .border-status-success { border-color: rgb(var(--status-success)); }
    .bg-status-success { background-color: rgb(var(--status-success)); }
    .text-status-warning { color: rgb(var(--status-warning)); }
    .border-status-warning { border-color: rgb(var(--status-warning)); }
    .bg-status-warning { background-color: rgb(var(--status-warning)); }
    

    /* Hover States (Defined separately for control) */
    .hover\:bg-brand-primary-darker:hover { background-color: rgb(var(--brand-primary-darker)); }
    .hover\:bg-brand-accent-darker:hover { background-color: rgb(var(--brand-accent-darker)); }
    .hover\:text-brand-primary-darker:hover { color: rgb(var(--brand-primary-darker)); }
    
    /* Example: Dark mode opacity for the gradient */
    .bg-serene-gradient {
        @apply dark:opacity-80; 
    }
}


:root {
  /* --- LIGHT MODE (Default) - RGB Values --- */
  
  /* Base */
  --bg-base: 250 250 250; /* Warm Linen (#FAFAFA) */
  --text-base: 45 55 72;  /* Charcoal (#2D3748) */
  --text-muted: 107 114 128; /* Gray 500 */

  /* Surfaces (Card Backgrounds) */
  --bg-surface-1: 255 255 255; /* White (Primary Card BG) */
  --bg-surface-2: 241 245 249; /* Slate 100 (Secondary BG/Input fill) */
  
  /* Brand Colors (Teal) */
  --brand-primary: 14 91 106;      /* Deep Teal (#0E5B6A - Teal 800 equivalent) */
  --brand-primary-light: 106 179 175; /* Soft Teal for Gradients/Hover BG */
  --brand-primary-darker: 12 75 88; /* Darker Teal for hover */
  
  /* Accent Colors (Amber/Gold) */
  --brand-accent: 245 158 11;     /* Warm Gold (#F59E0B - Amber 500 equivalent) */
  --brand-accent-darker: 217 119 6; /* Darker Gold for hover */

  /* Status */
  --status-success: 22 163 74; /* Green 600 */
  --status-warning: 234 88 12; /* Orange 600 */
}

/* --- DARK MODE DEFINITION --- */
.dark {
  /* Base */
  --bg-base: 30 41 57;      /* Slate 800 */
  --text-base: 240 240 240; /* Near White */
  --text-muted: 156 163 175; /* Gray 400 */
  
  /* Surfaces (Card Backgrounds) */
  --bg-surface-1: 44 59 74;  /* Slightly lighter slate (Card BG) */
  --bg-surface-2: 64 78 94;  /* Darker accent surface */
  
  /* Brand Colors (Teal - Must be lighter for contrast) */
  --brand-primary: 90 200 180;      /* Lighter Teal (#5AC8B4 - Teal 400 equivalent) */
  --brand-primary-light: 65 170 150; /* Slightly darker light for dark mode contrast */
  --brand-primary-darker: 14 91 106; /* Deep Teal for hover in dark mode */
  
  /* Accent Colors (Amber/Gold - Must be lighter) */
  --brand-accent: 251 191 36;     /* Lighter Gold (#FBEC24 - Amber 400 equivalent) */
  --brand-accent-darker: 245 158 11; /* Darker Gold for hover */

  /* Status */
  --status-success: 52 211 163; /* Green 400 */
  --status-warning: 251 191 36; /* Amber 400 */
  
  /* Ensure the dark class sets the root background for dark mode */
  background: rgb(var(--bg-base));
}

--- END FILE: src\app\globals.css ---

--- START FILE: src\app\layout.js ---

// src/app/layout.js 

import './globals.css';
import { AuthProvider } from '../context/AuthContext';
import Header from '../components/Header';
import Footer from '../components/Footer';
import ThemeInitializer from '@/components/ThemeInitializer'; 

export const metadata = {
  title: 'AnandaYog Meditation Centre: Inner Peace & Authentic Practice',
  description: 'Guided meditation, authentic yoga, and mindful living courses. Start your journey to tranquility today.',
};

export default function RootLayout({ children }) {
  return (
    // FIX 1: Explicitly set 'light' class to ensure Light Mode CSS variables 
    // are applied on the server side, eliminating the dark mode flash/default.
    <html lang="en" className="light"> 
      {/* 
        NOTE: For best visual results, link Google Fonts (Playfair Display & Inter) 
        in the <head> of the document or update the CSS. 
      */}
      <body className="flex flex-col min-h-screen antialiased">
        <AuthProvider>
          <ThemeInitializer /> 
          <Header />
          {/* FIX 2 (Gap Fix): Removed pb-16 padding to eliminate the gap between the content and the footer. */}
          <main className="grow"> 
            {children}
          </main>
          <Footer />
        </AuthProvider>
      </body>
    </html>
  );
}

--- END FILE: src\app\layout.js ---

--- START FILE: src\app\page.js ---

// src/app/page.js
import Link from 'next/link';

// NOTE: Ensure you have a background image named /public/placeholder-serene.jpg
// for the best visual effect.

const BlissfulHero = () => (
  // FIX: Changed h-[600px] to the canonical h-150 and hover:translate-y-[-2px] to hover:-translate-y-0.5
  <section className="relative h-150 flex items-center justify-center overflow-hidden shadow-2xl">
    {/* Background Image & Overlay */}
    <div className="absolute inset-0">
      <div 
        className="absolute inset-0 bg-cover bg-center transition duration-1000 ease-in-out hover:scale-[1.01]" 
        style={{ backgroundImage: "url('/placeholder-serene.jpg')" }}
      ></div>
      {/* CRITICAL FIX: The opacity needs to be *lower* (meaning less transparent) 
         to darken the background image effectively, now that the gradient itself is opaque. 
         Using opacity-60 provides a strong, dark teal overlay. */}
      <div className="absolute inset-0 bg-serene-gradient z-10 opacity-90"></div>
    </div>

    {/* Content */}
    <div className="relative z-20 text-center text-white p-6 max-w-5xl">
      {/* FIX: Set text color to white/80 for high contrast */}
      <p className="text-sm sm:text-lg font-light tracking-[0.3em] uppercase mb-4 opacity-90 text-white/80">
        THE ANANDAYOG CENTRE
      </p>
      {/* Responsive font size adjustment */}
      <h1 className="text-4xl sm:text-5xl md:text-7xl font-extrabold font-serif leading-tight mb-6 drop-shadow-lg">
        Find Silence. Find Yourself.
      </h1>
      <p className="text-lg md:text-2xl font-light mb-12 opacity-95 max-w-3xl mx-auto">
        Guided meditation and authentic yoga practices to quiet the mind and foster lasting peace.
      </p>
      <Link 
        href="/dashboard" // Changed to point to dashboard for login/status check
        // Refactored to use custom accent colors
        className="bg-brand-accent text-white text-xl font-bold py-4 px-12 rounded-full hover:bg-brand-accent-darker transition duration-300 shadow-2xl border-2 border-white/50 transform hover:-translate-y-0.5"
      >
        Start 7 Days Free
      </Link>
    </div>
  </section>
);


export default function HomePage() {
  return (
    <>
      <BlissfulHero />

      {/* Increased padding for more breathing room (UX Improvement) */}
      <div className="container mx-auto px-6 lg:px-12 py-20"> 
        {/* Core Values Section */}
        <section className="py-8 text-center">
          {/* Refactored text color */}
          <h2 className="text-4xl font-bold font-serif text-brand-primary mb-4">Our Practice Pillars</h2>
          <p className="text-lg text-surface-muted max-w-4xl mx-auto mb-16">
            AnandaYog is built on principles of authenticity, community, and accessible guidance for all levels of practitioners.
          </p>

          <div className="grid md:grid-cols-3 gap-10 text-left">
            <ValueCard 
              icon="üåø"
              title="Grounded in Tradition"
              description="Practices rooted in ancient texts, modernized for today's busy world."
            />
            <ValueCard 
              icon="üßò"
              title="Accessible Guidance"
              description="Courses structured clearly, perfect for beginners and deep divers alike."
            />
            <ValueCard 
              icon="‚ú®"
              title="Transformative Results"
              description="Tools designed to integrate profound peace and mindfulness into daily life."
            />
          </div>
        </section>
        
        {/* Featured Courses Call to Action */}
        {/* Refactored background/border colors to Surface 2 and Primary */}
        <section className="mt-20 text-center bg-surface-2 p-12 rounded-2xl shadow-2xl border-t-4 border-brand-primary">
            {/* Refactored text color */}
            <h2 className="text-4xl font-serif font-bold text-brand-primary mb-4">Ready for Inner Change?</h2>
            <p className="text-lg text-text-base mb-8 max-w-3xl mx-auto">
                Explore our full catalog of guided meditations, Hatha, and Vinyasa courses designed by master teachers.
            </p>
            <Link 
                href="/teachings" // <-- UPDATED LINK
                // Refactored CTA to use custom accent colors
                className="bg-brand-accent text-white font-bold text-lg py-4 px-10 rounded-full hover:bg-brand-accent-darker transition duration-300 shadow-lg"
            >
                Learn What We Teach
            </Link>
        </section>

      </div>
    </>
  );
}

// Helper Component (Updated Styling)
const ValueCard = ({ icon, title, description }) => (
    // Refactored background to Surface 1
    <div className="p-8 bg-surface-1 rounded-xl shadow-lg border border-gray-50 hover:shadow-xl transform hover:scale-[1.02] transition duration-300">
        {/* Refactored background color */}
        <div className="text-4xl mb-4 p-3 bg-surface-2 rounded-lg inline-block">{icon}</div>
        {/* Refactored text color */}
        <h3 className="text-2xl font-semibold text-brand-primary mb-3 font-serif">{title}</h3>
        {/* Refactored text color */}
        <p className="text-text-base">{description}</p>
    </div>
);

--- END FILE: src\app\page.js ---

--- START FILE: src\app\about\page.js ---

import Image from 'next/image';

export default function AboutPage() {
    return (
      <div className="container mx-auto p-8 sm:p-12">
        
        {/* Hero Section - Refactored background and text colors */}
        <div className="bg-surface-2 p-10 rounded-xl shadow-inner mb-12 text-center">
            <h1 className="text-5xl font-serif font-extrabold text-brand-primary mb-4">
                Our Roots, Our Vision
            </h1>
            <p className="text-xl text-text-muted max-w-3xl mx-auto">
                Dedicated to spreading the wisdom of yoga and meditation in a supportive and modern environment.
            </p>
        </div>

        {/* Mission Section */}
        <section className="grid md:grid-cols-2 gap-12 items-center py-10">
            <div>
                <h2 className="text-3xl font-bold text-brand-primary mb-4">The AnandaYog Mission</h2>
                <p className="text-text-base mb-4 leading-relaxed">
                    Founded on the belief that inner tranquility is accessible to everyone, AnandaYog was created to be a digital sanctuary. We move beyond trendy fitness routines to offer practices that truly connect you with your deepest self.
                </p>
                <p className="text-text-base leading-relaxed italic">
                    &quot;Ananda&quot; means bliss, and &quot;Yog&quot; means union. Our goal is to help you achieve the union of mind and body, leading to lasting joy.
                </p>
            </div>
            {/* Image Placeholder REPLACED with Next.js Image Component */}
            <div className="rounded-lg shadow-md overflow-hidden relative h-64 md:h-96">
                <Image
                    src="/studio.jpg" // Replace with your image filename
                    alt="A peaceful yoga and meditation studio interior"
                    fill // Fills the parent container (h-64/h-96)
                    sizes="(max-width: 768px) 100vw, 50vw"
                    className="object-cover"
                />
            </div>
        </section>

        {/* Teacher Profiles Section - UPDATED */}
        <section className="py-16 text-center">
            <h2 className="text-3xl font-bold text-brand-primary mb-8">Meet Our Lead Teacher</h2>
            <div className="flex justify-center">
                <TeacherCard 
                    name="Souparna Paul" 
                    specialty="Vipassana, Pranayama, Ashtanga & Raja Yoga" 
                    quote="The mind is everything. What you think, you become."
                />
            </div>
        </section>

      </div>
    );
}

// TeacherCard Component - Modified to remove experience text and only display the quote
const TeacherCard = ({ name, specialty, quote }) => (
    // Refactored background to Surface 1
    <div className="bg-surface-1 p-6 rounded-lg shadow-xl border border-gray-100 max-w-sm">
        {/* Refactored background color and icon color */}
        <div className="w-24 h-24 mx-auto bg-surface-2 rounded-full mb-4 flex items-center justify-center text-3xl text-brand-primary">
            üßò‚Äç‚ôÇÔ∏è
        </div>
        <h3 className="text-xl font-semibold text-text-base">{name}</h3>
        {/* Refactored text color */}
        <p className="text-brand-primary italic mb-3">{specialty}</p>

        {/* Quote Display - Now the final descriptive element */}
        {quote && (
            <p className="text-sm text-text-base italic border-t border-b border-gray-100 py-3">
                &quot;{quote}&quot;
            </p>
        )}
        
    </div>
);

--- END FILE: src\app\about\page.js ---

--- START FILE: src\app\account\page.js ---

// src/app/account/page.js
"use client";

import { useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useAuth } from '@/context/AuthContext';
// Note: This file is kept only for completeness in the file list, 
// but functionally it is now unused/redundant as /dashboard handles the logic.

export default function AccountPage() {
    const { currentUser, loading } = useAuth();
    const router = useRouter();

    useEffect(() => {
        // Always redirect to dashboard, which now contains the login/logout logic.
        if (!loading) {
            router.replace('/dashboard');
        }
    }, [loading, router]);

    if (loading) {
        return (
            <div className="flex justify-center items-center h-96">
                <p className="text-xl text-gray-500">Checking user status...</p>
            </div>
        );
    }
    
    // Fallback if redirection is slow
    return (
        <div className="flex justify-center items-center h-96">
            <p className="text-xl text-teal-600">Redirecting to Dashboard...</p>
        </div>
    );
}

--- END FILE: src\app\account\page.js ---

--- START FILE: src\app\api\contact\route.js ---

// src/app/api/contact/route.js
// Handles submissions from the contact form (src/app/contact/page.js)

import { NextResponse } from 'next/server';

// NOTE: The frontend (src/app/contact/page.js) has been updated to use the 
// third-party service Web3Forms directly for submission. 
// This API route is now retained only as a placeholder/backup, 
// but is no longer actively called by the contact form.

export async function POST(request) {
  try {
    const data = await request.json();
    
    // 1. Validate data (simple check)
    if (!data.name || !data.email || !data.message) {
      return NextResponse.json({ error: 'Missing required fields' }, { status: 400 });
    }

    console.log("--- CONTACT FORM SUBMISSION RECEIVED ---");
    console.log(`From: ${data.name} (${data.email})`);
    console.log(`Message: ${data.message.substring(0, 50)}...`);
    console.log("--- End Submission ---");

    // 2. Simulate sending email (takes 1-2 seconds)
    await new Promise(resolve => setTimeout(resolve, 1500));

    // 3. Return success response
    return NextResponse.json({ 
      message: 'Message received successfully!',
      debug: 'Server action simulated (Replace with real email logic)' 
    }, { status: 200 });

  } catch (error) {
    console.error("Contact Form Error:", error);
    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
  }
}

--- END FILE: src\app\api\contact\route.js ---

--- START FILE: src\app\api\create-order\route.js ---

// src/app/api/create-order/route.js (Node.js Serverless Function)

import { NextResponse } from 'next/server';
import Razorpay from 'razorpay';

// Use environment variables securely
const razorpay = new Razorpay({
  key_id: process.env.RAZORPAY_KEY_ID,
  key_secret: process.env.RAZORPAY_KEY_SECRET,
});

export async function POST(request) {
  try {
    // Expect amount, currency, and receiptId (which is userId)
    const { amount, currency = 'INR', receiptId, planName } = await request.json();

    if (!amount || amount < 1) {
        return NextResponse.json({ error: 'Invalid amount.' }, { status: 400 });
    }

    // --- FIX for Razorpay receipt length limit (max 40 chars) ---
    // Use the user ID (receiptId) and a short, time-based suffix for uniqueness.
    // Firebase UID is usually ~28 chars, leaving plenty of room.
    const timeSuffix = Date.now().toString().slice(-6); // Last 6 digits of timestamp
    const shortReceipt = `user_${receiptId.substring(0, 20)}_${timeSuffix}`;
    // This ensures the receipt is always well under 40 characters.
    // -------------------------------------------------------------

    const options = {
      amount: amount * 100, // Convert to paisa
      currency: currency,
      receipt: shortReceipt, // Use the shortened receipt
      payment_capture: 1, 
      notes: { planName } // Add plan name to notes
    };

    const order = await razorpay.orders.create(options);

    // Only expose the public key and order ID to the client
    return NextResponse.json({
      id: order.id,
      currency: order.currency,
      amount: order.amount,
      key: process.env.RAZORPAY_KEY_ID,
      planName 
    }, { status: 200 });

  } catch (error) {
    console.error("Error creating Razorpay order:", error);
    
    // Ensure we return a structured error response
    const status = error.statusCode || 500;
    const errorMessage = error.error?.description || error.message || 'Internal Server Error';
    return NextResponse.json({ error: errorMessage }, { status });
  }
}

--- END FILE: src\app\api\create-order\route.js ---

--- START FILE: src\app\api\verify-payment\route.js ---

// src/app/api/verify-payment/route.js
// CRITICAL: Securely verifies the Razorpay payment signature

import { NextResponse } from 'next/server';
import { db } from '@/lib/firebase';
import { doc, setDoc, getDoc } from 'firebase/firestore'; // <-- ADDED getDoc
import Razorpay from 'razorpay';
import crypto from 'crypto';

// Re-initialize Razorpay (Secret key is only used securely on the server)
const razorpay = new Razorpay({
  key_id: process.env.RAZORPAY_KEY_ID,
  key_secret: process.env.RAZORPAY_KEY_SECRET,
});

export async function POST(request) {
  try {
    const { 
      orderId, 
      paymentId, 
      signature, 
      userId, 
      amount,
      planName 
    } = await request.json();

    // 1. Construct the signature string
    const shasum = crypto.createHmac('sha256', process.env.RAZORPAY_KEY_SECRET);
    shasum.update(`${orderId}|${paymentId}`);
    const digest = shasum.digest('hex');

    // 2. Compare the calculated digest with the signature received from the client
    if (digest !== signature) {
      return NextResponse.json({ status: 'failure', message: 'Signature verification failed.' }, { status: 400 });
    }

    // --- Verification Successful ---
    
    // 3. Implement CUMULATIVE EXPIRATION LOGIC
    const userRef = doc(db, "users", userId);
    const userSnap = await getDoc(userRef); 

    let baseDate = new Date(); // Default start is now

    if (userSnap.exists()) {
        const data = userSnap.data();
        if (data.subscriptionExpires) {
            const existingExpiry = new Date(data.subscriptionExpires);
            // If the existing subscription is still in the future, use it as the new base date
            if (existingExpiry > baseDate) {
                baseDate = existingExpiry;
            }
        }
    }
    
    let expirationDate = new Date(baseDate.getTime()); // Clone the base date for calculation

    if (planName === 'Yogi Monthly') {
        expirationDate.setMonth(expirationDate.getMonth() + 1);
    } else if (planName === 'Yogi Annual') {
        expirationDate.setFullYear(expirationDate.getFullYear() + 1);
    }

    // 4. Update the user's Firestore record (Heavy Lifting Done Here!)
    await setDoc(userRef, {
      lastSubscriptionDate: new Date().toISOString(),
      subscriptionExpires: expirationDate.toISOString(),
      isSubscribed: true,
      subscriptionPlan: planName, // Store the specific plan
      razorpayDetails: { orderId, paymentId, signature, amount },
    }, { merge: true });

    return NextResponse.json({ 
      status: 'success', 
      message: 'Payment verified and subscription activated!',
      userId 
    }, { status: 200 });

  } catch (error) {
    console.error("Payment Verification Error:", error);
    return NextResponse.json({ status: 'error', message: 'Internal server error during verification.' }, { status: 500 });
  }
}

--- END FILE: src\app\api\verify-payment\route.js ---

--- START FILE: src\app\contact\page.js ---

// src/app/contact/page.js
"use client";

import { useState } from 'react';

// Target email address provided by the user
const DIRECT_EMAIL = 'souparnopaulreborn@gmail.com';

export default function ContactPage() {
    const [status, setStatus] = useState(null);
    const [isSubmitting, setIsSubmitting] = useState(false);
    // New state to trigger the prominent fallback message
    const [submissionFailed, setSubmissionFailed] = useState(false); 

    const handleSubmit = async (e) => {
        e.preventDefault();
        setIsSubmitting(true);
        setStatus('Sending...');
        setSubmissionFailed(false);
        
        // Retrieve the Web3Forms access key
        const accessKey = process.env.NEXT_PUBLIC_WEB3FORMS_ACCESS_KEY;
        if (!accessKey) {
            setStatus('Configuration Error: Web3Forms access key is missing.');
            setSubmissionFailed(true);
            setIsSubmitting(false);
            return;
        }

        const formData = new FormData(e.target);
        // CRITICAL: Append the access key for Web3Forms
        formData.append("access_key", accessKey);
        // Optional: Add a subject line
        formData.append("subject", "New Contact Form Submission from AnandaYog");


        try {
            // POST request to the Web3Forms endpoint
            const response = await fetch('https://api.web3forms.com/submit', {
                method: 'POST',
                body: formData,
            });

            const result = await response.json();

            if (result.success) {
                setStatus('Thank you! Your message has been received.');
                e.target.reset();
            } else {
                // Specific handling for submission failures (e.g., rate limits, errors)
                console.error("Web3Forms Submission Error:", result.message);
                
                // Set status and trigger the fallback visual
                setStatus(`Error: ${result.message || 'Failed to submit form.'}`);
                setSubmissionFailed(true);
            }
        } catch (error) {
            console.error("Network or Submission Error:", error);
            setStatus('Network error. Failed to connect to submission service.');
            setSubmissionFailed(true);
        } finally {
            setIsSubmitting(false);
        }
    };

    return (
      <div className="container mx-auto p-8 max-w-4xl">
        
        <div className="text-center mb-12">
            <h1 className="text-5xl font-serif font-extrabold text-brand-primary mb-4">
                Connect With Us
            </h1>
            <p className="text-xl text-text-muted">
                We are here to answer your questions and guide your practice.
            </p>
        </div>

        {/* Refactored background to Surface 1 */}
        <div className="bg-surface-1 p-10 rounded-2xl shadow-2xl border border-gray-100">
            <form onSubmit={handleSubmit} className="space-y-6">
                <div>
                    <label htmlFor="name" className="block text-sm font-semibold text-text-base mb-1">
                        Full Name
                    </label>
                    <input
                        type="text"
                        id="name"
                        name="name" // Name attribute required for Web3Forms
                        required
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-brand-primary focus:border-brand-primary transition duration-150"
                    />
                </div>
                
                <div>
                    <label htmlFor="email" className="block text-sm font-semibold text-text-base mb-1">
                        Email Address
                    </label>
                    <input
                        type="email"
                        id="email"
                        name="email" // Name attribute required for Web3Forms
                        required
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-brand-primary focus:border-brand-primary transition duration-150"
                    />
                </div>

                <div>
                    <label htmlFor="message" className="block text-sm font-semibold text-text-base mb-1">
                        Your Message
                    </label>
                    <textarea
                        id="message"
                        name="message" // Name attribute required for Web3Forms
                        rows="5"
                        required
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-brand-primary focus:border-brand-primary transition duration-150"
                    ></textarea>
                </div>

                <button
                    type="submit"
                    // Refactored button to use accent colors
                    className="w-full bg-brand-accent text-white font-bold py-3 rounded-lg hover:bg-brand-accent-darker transition duration-300 shadow-md disabled:opacity-50"
                    disabled={isSubmitting || status?.includes('Thank you')}
                >
                    {isSubmitting ? 'Sending...' : 'Send Message'}
                </button>
                
                {status && (
                    <p className={`mt-4 text-center text-sm font-medium ${status.includes('Thank you') ? 'text-status-success' : 'text-red-500'}`}>
                        {status}
                    </p>
                )}
            </form>
            
            {/* Direct Email Fallback Section */}
            <div className={`mt-8 pt-6 border-t border-gray-200 text-center transition-opacity duration-500`}>
                <p className="text-text-base mb-3">
                    {submissionFailed 
                        ? (
                            // Display user-requested fallback message
                            <span className="font-bold text-lg text-brand-primary">
                                There are too many requests right now. Please send us an email directly instead.
                            </span>
                        ) 
                        : "Prefer to email directly?"}
                </p>
                
                {/* Clickable Mailto Link */}
                <a 
                    href={`mailto:${DIRECT_EMAIL}?subject=Inquiry%20from%20AnandaYog%20Website`} 
                    className="text-lg font-bold text-brand-accent hover:text-brand-accent-darker hover:underline transition"
                >
                    {DIRECT_EMAIL}
                </a>
            </div>
        </div>

      </div>
    );
}

--- END FILE: src\app\contact\page.js ---

--- START FILE: src\app\courses\[id]\page.js ---

// src/app/courses/[id]/page.js
// NO "use client" directive here! This is a Server Component.

import { notFound } from 'next/navigation';
import CourseContent from '@/components/CourseContent';

// Simplified hardcoded course data (Used here only for existence check)
const ALL_COURSES = {
    'beginners_mind': {},
    'vipassana_deep_dive': {},
    'hatha_flow': {},
    'pranayama_masterclass': {},
    'ashtanga_ultimatum': {},
    'raja_yoga_supreme': {},
};


// Made the component async to handle asynchronous parameters
export default async function CourseDetailPage({ params }) {
    
    // --- CRITICAL FIX: Explicitly await the params object ---
    // This is necessary because the framework is proxying 'params' as a Promise
    // even in an async function context in your specific version/setup (Next 16.1.0/Turbopack).
    const resolvedParams = await params;
    const courseId = resolvedParams.id;
    // --------------------------------------------------------
    
    const courseExists = ALL_COURSES.hasOwnProperty(courseId);

    if (!courseExists) {
        notFound();
    }
    
    // Pass the safely retrieved ID to the client component
    return (
        <CourseContent courseId={courseId} />
    );
}

--- END FILE: src\app\courses\[id]\page.js ---

--- START FILE: src\app\dashboard\page.js ---

// src/app/dashboard/page.js
"use client"; 

import Link from 'next/link';
import PaymentInitiator from '@/components/PaymentInitiator'; 
import AuthStatus from '@/components/AuthStatus'; 
import { useAuth } from '@/context/AuthContext'; 
import AdminPanel from '@/components/AdminPanel'; // Import Admin Panel

// Define hardcoded course list for dashboard progress display (must match IDs in src/app/courses/[id]/page.js)
const TRACKED_COURSES = [
    { id: 'beginners_mind', name: "Beginner's Mind (7 Days)", totalLessons: 7, isPremium: false },
    { id: 'vipassana_deep_dive', name: "Vipassana Deep Dive", totalLessons: 15, isPremium: true },
    { id: 'hatha_flow', name: "Hatha Flow for Flexibility", totalLessons: 10, isPremium: true },
    { id: 'pranayama_masterclass', name: "Pranayama Masterclass", totalLessons: 12, isPremium: true },
    { id: 'ashtanga_ultimatum', name: "Ashtanga Yoga Ultimatum", totalLessons: 20, isPremium: true },
    { id: 'raja_yoga_supreme', name: "Raja Yoga Supreme", totalLessons: 8, isPremium: true },
];


export default function DashboardPage() {
  const { currentUser, userData, loading, logout, isAdmin } = useAuth(); // Added isAdmin

  if (loading) {
    return (
      <div className="flex justify-center items-center h-96">
        <div className="animate-pulse text-xl text-brand-primary">
             Checking user status...
        </div>
      </div>
    );
  }

  // Handle NOT LOGGED IN state: Show the beautiful login UI directly
  if (!currentUser) {
    return (
        // FIX (Gap & Background): Ensures the background is fully covered and the content is centered.
        // Refactored background to Surface 1 and border to Primary
        <div className="flex items-center justify-center h-full min-h-[calc(100vh-5rem)] p-4 transition-colors duration-300">
            <div className="w-full max-w-md p-8 sm:p-10 text-center bg-surface-1 rounded-2xl shadow-2xl border-t-4 border-brand-primary transform transition duration-500 hover:shadow-3xl">
                {/* Refactored text color */}
                <h1 className="text-4xl font-serif font-bold text-brand-primary mb-4">
                    Access Your Sanctuary
                </h1>
                <p className="text-lg text-text-muted mb-10">
                    Sign in with Google to manage your account and begin your practice.
                </p>
                {/* Use AuthStatus here to present the login UI */}
                <AuthStatus />
            </div>
        </div>
    );
  }

  // Determine access level
  const isSubscribed = userData?.isSubscribed;
  const currentPlan = userData?.subscriptionPlan || 'Explorer (Free Tier)';
  
  // FIX: Added logic to calculate remaining days
  let daysRemaining = 'N/A';
  if (isSubscribed && userData?.subscriptionExpires) {
      const expiryDate = new Date(userData.subscriptionExpires);
      const now = new Date();
      const diffTime = expiryDate - now; // Time difference in milliseconds
      
      if (diffTime > 0) {
          daysRemaining = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      } else {
          daysRemaining = 0; // Subscription is technically expired but we still show the date
      }
  }
  
  const expirationDate = userData?.subscriptionExpires ? 
    new Date(userData.subscriptionExpires).toLocaleDateString() : 'N/A';

  // Use standard Tailwind colors for status indicators for clear differentiation
  const accessColor = isSubscribed ? 'text-green-600' : 'text-amber-600'; 
  const accessBorderColor = isSubscribed ? 'border-green-500' : 'border-amber-500';

  // Calculate progress for display
  const getUserProgress = (courseId) => {
    const courseData = TRACKED_COURSES.find(c => c.id === courseId);
    if (!userData?.progress || !courseData) return '0%';

    const lessonProgress = userData.progress[courseId];
    if (!lessonProgress) return '0%';

    // Calculate completed lessons by counting entries that have 'completed: true'
    const completedLessons = Object.values(lessonProgress).filter(
        (lesson) => lesson.completed === true
    ).length;

    const percentage = Math.round((completedLessons / courseData.totalLessons) * 100);
    return isNaN(percentage) ? '0%' : `${percentage}%`;
  };
  
  // Determine accessible courses based on subscription status
  const accessibleCourses = TRACKED_COURSES.filter(course => !course.isPremium || isSubscribed);
  const freeCourses = TRACKED_COURSES.filter(course => !course.isPremium);

  return (
    <div className="container mx-auto p-8 max-w-6xl">
      <h1 className="text-4xl font-serif font-bold text-brand-primary mb-2">
        Welcome Back, {currentUser?.displayName?.split(' ')[0] || 'Yogi'}!
      </h1>
      <p className="text-lg text-text-muted mb-8">
        Manage your path to Ananda (Bliss).
      </p>

      <div className="grid lg:grid-cols-3 gap-8">
        {/* Column 1: Status & Logout */}
        <div className="lg:col-span-1 space-y-8">
            {/* Subscription Status Card - Refactored background to Surface 1 */}
            <div className={`bg-surface-1 p-6 rounded-lg shadow-2xl border-l-4 ${accessBorderColor} `}>
                <h2 className="text-2xl font-semibold mb-3 text-text-base">Membership Status</h2>
                <p className="text-md text-text-base">
                  Plan: 
                  <span className={`font-bold ml-2 ${accessColor}`}>
                    {currentPlan}
                  </span>
                </p>
                {isSubscribed && (
                    <>
                        <p className="text-sm text-text-muted mt-2">
                            Expires: {expirationDate}
                        </p>
                        <p className={`text-sm font-medium mt-1 ${daysRemaining > 7 ? 'text-status-success' : 'text-status-warning'}`}>
                            Days Remaining: {daysRemaining}
                        </p>
                    </>
                )}
                {!isSubscribed && (
                    <p className="text-sm text-status-warning font-medium mt-3">
                        Subscription Expired or Inactive. Renew now to unlock all premium courses.
                    </p>
                )}
            </div>
            
            {/* Usage/Progress Placeholder - NOW DYNAMICALLY TRACKED */}
            <div className="p-6 bg-surface-2 rounded-lg shadow-inner">
                <h3 className="text-xl font-serif font-bold text-brand-primary mb-4">Your Course Progress</h3>
                <ul className="space-y-3 text-text-base">
                    {TRACKED_COURSES.map(course => {
                        const isAccessible = !course.isPremium || isSubscribed;
                        const progress = getUserProgress(course.id);
                        const progressValue = parseInt(progress.replace('%', ''), 10);

                        return (
                            <li key={course.id}>
                                <div className="flex justify-between items-center text-sm mb-1">
                                    <span>{course.name}</span> 
                                    <span className={`font-medium ${isAccessible ? 'text-brand-primary' : 'text-text-muted'}`}>
                                        {isAccessible ? progress : 'LOCKED'}
                                    </span>
                                </div>
                                {/* Progress Bar */}
                                <div className="w-full bg-gray-300 rounded-full h-2">
                                    <div 
                                        className={`h-2 rounded-full transition-all duration-700 ${isAccessible ? 'bg-brand-accent' : 'bg-gray-400'}`}
                                        style={{ width: `${progressValue}%` }}
                                    ></div>
                                </div>
                            </li>
                        );
                    })}
                </ul>
                <li className="text-xs text-text-muted pt-4">
                    Progress tracked in real-time upon lesson completion.
                </li>
            </div>

            {/* Logout Section */}
            <div className="p-6 bg-red-50 border border-red-200 rounded-lg">
                <button
                    onClick={logout}
                    className="w-full bg-red-600 text-white font-bold py-2 rounded-lg hover:bg-red-700 transition"
                >
                    Logout
                </button>
            </div>
            
            {/* Admin Link */}
            {isAdmin && (
                <Link href="/wisdom" className="block text-center p-4 bg-brand-accent text-white font-bold rounded-lg shadow-lg hover:bg-brand-accent-darker transition">
                    ‚òÖ Go to Admin Wisdom Portal
                </Link>
            )}
        </div>

        {/* Column 2 & 3: Payment & Protected Content */}
        <div className="lg:col-span-2 space-y-8">
            
            {/* Payment Options (Show only if NOT subscribed) */}
            {!isSubscribed && (
                <div className="space-y-6">
                    <h2 className="text-3xl font-serif font-bold text-brand-primary mb-4">Select Your Subscription</h2>
                    <div className="grid md:grid-cols-2 gap-6">
                        <PaymentInitiator 
                            planName="Yogi Monthly" 
                            amount={500} 
                            description="Unlimited access, billed monthly." 
                        />
                        <PaymentInitiator 
                            planName="Yogi Annual" 
                            amount={4800} 
                            description="Unlimited access, billed yearly (2 months free)." 
                            isAnnual={true}
                        />
                    </div>
                </div>
            )}


            {/* Protected Content Section - Refactored background and border */}
            <div className="p-8 bg-surface-1 rounded-lg shadow-xl border-t-4 border-brand-primary">
                <h2 className="text-2xl font-serif font-bold mb-5 text-brand-primary">Your Course Library</h2>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {/* Free Content (Always Available) */}
                    {freeCourses.map(course => (
                        <CourseLink 
                            key={course.id} 
                            title={course.name} 
                            href={`/courses/${course.id}`} 
                            isPremium={false} 
                        />
                    ))}
                    
                    {/* Premium Content (Conditional Access) */}
                    {TRACKED_COURSES.filter(c => c.isPremium).map(course => (
                        <CourseLink 
                            key={course.id} 
                            title={course.name} 
                            href={`/courses/${course.id}`} 
                            isPremium={true}
                            isLocked={!isSubscribed}
                        />
                    ))}
                    
                    {/* Universal Content */}
                    <CourseLink title="Bhagavad Gita Reader" href="/gita" isPremium={false} />
                    <CourseLink title="The Yogi's Wisdom" href="/wisdom" isPremium={false} />
                </div>
                
                {!isSubscribed && (
                    <div className="text-center p-4 mt-6 bg-surface-2 border-2 border-dashed border-brand-accent rounded-lg">
                        <p className="text-lg text-brand-accent font-medium">
                            Upgrade to unlock premium content!
                        </p>
                    </div>
                )}
            </div>
        </div>
      </div> {/* End Grid */}
    </div>
  );
}

const CourseLink = ({ title, href, isPremium, isLocked = false }) => {
    const borderColor = isPremium ? 'border-brand-accent' : 'border-brand-primary';
    const linkClass = isLocked ? 'opacity-60 cursor-default' : 'hover:bg-brand-primary-light';
    const textClass = isLocked ? 'text-text-muted' : 'text-text-base';
    
    const content = (
        <div className={`p-4 bg-surface-2 rounded-lg shadow-sm transition duration-200 border-l-4 ${borderColor} ${linkClass}`}>
            <p className={`font-semibold ${textClass}`}>{title}</p>
            <p className="text-sm text-text-muted">
                {isLocked ? 'üîí Subscription Required' : 'Start Lesson 1 ‚Üí'}
            </p>
        </div>
    );
    
    return isLocked ? <div className='block'>{content}</div> : <Link href={href}>{content}</Link>;
};

--- END FILE: src\app\dashboard\page.js ---

--- START FILE: src\app\gita\page.js ---

// src/app/gita/page.js

import GitaReader from '@/components/GitaReader';

export const metadata = {
  title: 'Bhagavad Gita Reader - AnandaYog',
  description: 'Read the Bhagavad Gita in English, Hindi, and Bengali using an interactive PDF reader. Your reading progress and bookmarks are saved in real-time.',
};

export default function GitaPage() {
    return (
        <GitaReader />
    );
}

--- END FILE: src\app\gita\page.js ---

--- START FILE: src\app\policy\page.js ---

// src/app/policy/page.js
// Request #7: Privacy Policy Content

import Link from 'next/link';

export default function PolicyPage() {
    return (
        <div className="container mx-auto p-8 max-w-4xl">
            <h1 className="text-4xl font-serif font-bold text-brand-primary mb-6">Privacy Policy</h1>
            <p className="text-sm italic text-red-600 dark:text-red-400 mb-6">
                NOTE: This is a legal template for demonstration purposes. Please consult with a legal professional before deploying this policy in a live environment.
            </p>

            <section className="space-y-4 text-text-base">
                <h2 className="text-2xl font-semibold text-brand-primary mt-6">1. Information We Collect</h2>
                <p>
                    We collect personal information that you voluntarily provide to us when you register on the Services, express an interest in obtaining information about us or our products and Services, when you participate in activities on the Services, or otherwise when you contact us.
                </p>
                <ul className="list-disc list-inside ml-4">
                    <li>**Personal Information:** Email address (for login via Google Authentication), display name, and unique user ID (UID).</li>
                    <li>**Payment Data:** We do not store full credit card details. Payment processing is handled securely by Razorpay, and we only retain the payment ID, order ID, and signature for verification purposes.</li>
                    <li>**Usage Data:** Subscription status, expiration date, completed lessons, and theme preference.</li>
                </ul>

                <h2 className="text-2xl font-semibold text-brand-primary mt-6">2. How We Use Your Information</h2>
                <p>
                    We use the information we collect or receive for the following purposes:
                </p>
                <ul className="list-disc list-inside ml-4">
                    <li>To facilitate account creation and login process.</li>
                    <li>To determine your access level (free vs. premium content).</li>
                    <li>To track your course progress and store your subscription history.</li>
                    <li>To send you administrative information, such as service changes and policy updates.</li>
                    <li>To respond to your inquiries (via the Contact Form API endpoint).</li>
                </ul>

                <h2 className="text-2xl font-semibold text-brand-primary mt-6">3. Data Security</h2>
                <p>
                    We have implemented appropriate security measures designed to protect the security of any personal information we process. However, despite our safeguards and efforts to secure your information, no electronic transmission over the Internet or information storage technology can be guaranteed to be 100% secure.
                </p>
                
                <h2 className="text-2xl font-semibold text-brand-primary mt-6">4. Contact Us</h2>
                <p>
                    If you have questions or comments about this policy, you may contact us via our <Link href="/contact" className="text-brand-primary hover:underline">Contact Page</Link>.
                </p>
            </section>
        </div>
    );
}

--- END FILE: src\app\policy\page.js ---

--- START FILE: src\app\pricing\page.js ---

// src/app/pricing/page.js

import Link from 'next/link';

export default function PricingPage() {
  return (
    <div className="container mx-auto p-8 text-center">
      <h1 className="text-4xl font-serif font-bold text-brand-primary mb-10">
        Choose Your Path to Peace
      </h1>

      <div className="grid md:grid-cols-3 gap-8 max-w-4xl mx-auto">
        {/* Tier 1: Free (Refactored to Surface 1) */}
        <div className="bg-surface-1 p-8 rounded-xl shadow-2xl border-2 border-gray-200 transform hover:scale-105 transition duration-300">
          <h2 className="text-2xl font-bold text-text-base mb-2">Explorer</h2>
          <p className="text-4xl font-extrabold text-status-success mb-6">Free</p>
          <ul className="text-left space-y-3 text-text-muted mb-8">
            <li className="text-text-base">‚úì Access to 5 Foundational Videos</li>
            <li className="text-text-base">‚úì Weekly Newsletter</li>
            <li className="text-text-muted">‚úó Unlimited Course Access</li>
          </ul>
          <Link 
            href="/teachings" // <-- UPDATED LINK
            className="w-full inline-block bg-surface-2 text-text-base py-3 rounded-lg font-semibold hover:bg-gray-300 transition"
          >
            Start Learning
          </Link>
        </div>

        {/* Tier 2: Monthly Subscription (Primary Accent Card) */}
        <div className="bg-surface-1 p-8 rounded-xl shadow-2xl border-2 border-brand-accent transform hover:scale-105 transition duration-300">
          <p className="text-sm font-semibold text-white bg-brand-accent inline-block px-3 py-1 rounded-full mb-4">Recommended</p>
          <h2 className="text-2xl font-bold text-brand-primary mb-2">Yogi Monthly</h2>
          <p className="text-4xl font-extrabold text-brand-accent mb-6">‚Çπ500/mo</p>
          <ul className="text-left space-y-3 text-text-base mb-8">
            <li>‚úì All Free Tier benefits</li>
            <li>‚úì Unlimited Course Access</li>
            <li>‚úì Live Q&A Sessions (Weekly)</li>
          </ul>
          <Link 
            href="/dashboard" // <-- UPDATED LINK
            className="w-full inline-block bg-brand-accent text-white py-3 rounded-lg font-semibold hover:bg-brand-accent-darker transition shadow-lg"
          >
            Subscribe Now
          </Link>
        </div>

        {/* Tier 3: Annual Subscription (Primary Brand Card) */}
        <div className="bg-surface-1 p-8 rounded-xl shadow-2xl border-2 border-brand-primary transform hover:scale-105 transition duration-300">
          <h2 className="text-2xl font-bold text-brand-primary mb-2">Yogi Annual</h2>
          <p className="text-4xl font-extrabold text-brand-primary mb-1">‚Çπ4,800/yr</p>
          {/* Added savings text */}
          <p className="text-sm text-status-success mb-6 font-medium">(Save ‚Çπ1,200 - 2 Months Free!)</p> 
          <ul className="text-left space-y-3 text-text-base mb-8">
            <li>‚úì All Monthly benefits</li>
            <li>‚úì 2 Months Free (Included)</li>
            <li>‚úì Private Member Community</li>
          </ul>
          <Link 
            href="/dashboard" // <-- UPDATED LINK
            className="w-full inline-block bg-brand-primary text-white py-3 rounded-lg font-semibold hover:bg-brand-primary-darker transition"
          >
            Go Annual
          </Link>
        </div>
      </div>
    </div>
  );
}

--- END FILE: src\app\pricing\page.js ---

--- START FILE: src\app\teachings\page.js ---

// src/app/teachings/page.js
import Link from 'next/link';
import { useAuth } from '@/context/AuthContext';

const TEACHING_PRINCIPLES = [
    { 
        title: "The Eightfold Path", 
        description: "Practices rooted in Patanjali's Yoga Sutras, focusing on mental and ethical discipline (Raja Yoga)."
    },
    { 
        title: "Prana & Breathwork", 
        description: "Mastering life force (Pranayama) through structured breathing techniques for energy control and calm."
    },
    { 
        title: "Vipassana Meditation", 
        description: "The traditional method of insight meditation, focusing on deep, non-judgmental awareness of body sensations."
    },
    { 
        title: "Hatha & Vinyasa", 
        description: "Physical practices (Asana) blended into gentle Hatha flows and dynamic Vinyasa sequences for body integration."
    },
];

const CoursePillars = () => (
    <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
        {TEACHING_PRINCIPLES.map((pillar, index) => (
            <div 
                key={index} 
                // Refactored background to Surface 1
                className="bg-surface-1 p-6 rounded-xl shadow-lg border-t-4 border-brand-accent transform hover:scale-[1.03] transition duration-300"
            >
                <h3 className="text-xl font-semibold font-serif text-brand-primary mb-2">{pillar.title}</h3>
                <p className="text-text-base text-sm">{pillar.description}</p>
            </div>
        ))}
    </div>
);

export default function TeachingsPage() {
    return (
        <div className="container mx-auto p-8 max-w-6xl">
            {/* Hero Section */}
            <header className="text-center mb-16 pt-8">
                <h1 className="text-5xl font-serif font-extrabold text-brand-primary mb-4">
                    The AnandaYog Path: What We Teach
                </h1>
                <p className="text-xl text-text-muted max-w-4xl mx-auto">
                    We offer an integrated approach to ancient wisdom, guiding you from foundational breathwork to deep self-inquiry and liberation.
                </p>
            </header>

            {/* Teaching Pillars */}
            <section className="mb-16">
                <h2 className="text-3xl font-bold font-serif text-brand-primary mb-8 text-center">
                    Our Four Pillars of Practice
                </h2>
                <CoursePillars />
            </section>

            {/* Course Methodology */}
            <section className="bg-surface-2 p-10 rounded-2xl shadow-inner border-l-4 border-brand-primary">
                <h2 className="text-3xl font-bold font-serif text-brand-primary mb-4">
                    Our Course Methodology
                </h2>
                <div className="space-y-6 text-text-base">
                    <p>
                        All our premium courses are structured to facilitate growth at your own pace. Content is delivered via high-quality video, audio, and supplementary text guides. Access to our entire library is unlocked through a single monthly or annual subscription.
                    </p>
                    <ul className="list-disc list-inside ml-4 space-y-2">
                        <li>**Foundational Courses:** Accessible to all (even free tier) to establish the basics.</li>
                        <li>**Deep Dive Modules:** Reserved for subscribed members, providing structured paths in specific disciplines like Vipassana or Ashtanga.</li>
                        <li>**Progress Tracking:** Your completion status is saved in real-time to your dashboard.</li>
                    </ul>
                </div>
                
                <div className="mt-8 text-center">
                    <Link 
                        href="/pricing"
                        // Refactored CTA to use custom accent colors
                        className="inline-block bg-brand-accent text-white font-bold text-lg py-4 px-10 rounded-full hover:bg-brand-accent-darker transition duration-300 shadow-lg"
                    >
                        See Subscription Plans
                    </Link>
                </div>
            </section>
        </div>
    );
}


--- END FILE: src\app\teachings\page.js ---

--- START FILE: src\app\terms\page.js ---

// src/app/terms/page.js
// Request #7: Terms of Service Content

import Link from 'next/link';

export default function TermsPage() {
    return (
        <div className="container mx-auto p-8 max-w-4xl">
            <h1 className="text-4xl font-serif font-bold text-brand-primary mb-6">Terms of Service</h1>
            <p className="text-sm italic text-red-600 dark:text-red-400 mb-6">
                NOTE: This is a legal template for demonstration purposes. Please consult with a legal professional before deploying these terms in a live environment.
            </p>

            <section className="space-y-4 text-text-base">
                <h2 className="text-2xl font-semibold text-brand-primary mt-6">1. Agreement to Terms</h2>
                <p>
                    By accessing or using our website and services (AnandaYog), you agree to be bound by these Terms of Service (&quot;Terms&quot;). If you disagree with any part of the terms, then you may not access the Service.
                </p>

                <h2 className="text-2xl font-semibold text-brand-primary mt-6">2. Subscription and Payments</h2>
                <p>
                    Some parts of the Service are billed on a subscription basis (&quot;Subscription&quot;). You will be billed in advance on a recurring, periodic basis (such as monthly or annually). Payment processing is handled by Razorpay. Failure to pay may result in the termination of your subscription access.
                </p>

                <h2 className="text-2xl font-semibold text-brand-primary mt-6">3. Content and Intellectual Property</h2>
                <p>
                    All content provided on AnandaYog, including course videos, text, graphics, and logos, are the property of AnandaYog and are protected by copyright laws. You may not reproduce, redistribute, or create derivative works from the content without explicit written permission.
                </p>

                <h2 className="text-2xl font-semibold text-brand-primary mt-6">4. Limitation of Liability</h2>
                <p>
                    The Service is provided on an &quot;AS IS&quot; and &quot;AS AVAILABLE&quot; basis. AnandaYog makes no representations or warranties of any kind, express or implied, as to the operation of their services, or the information, content or materials included therein. You expressly agree that your use of the Service is at your sole risk.
                </p>
                
                <h2 className="text-2xl font-semibold text-brand-primary mt-6">5. Changes to Terms</h2>
                <p>
                    We reserve the right, at our sole discretion, to modify or replace these Terms at any time. We will provide at least 30 days notice before any new terms take effect.
                </p>
            </section>
        </div>
    );
}

--- END FILE: src\app\terms\page.js ---

--- START FILE: src\app\wisdom\page.js ---

// src/app/wisdom/page.js
"use client";

import { useAuth } from '@/context/AuthContext';
import { db } from '@/lib/firebase';
import { collection, query, orderBy, onSnapshot } from 'firebase/firestore';
import { useState, useEffect } from 'react';
import AdminPanel from '@/components/AdminPanel';
import Link from 'next/link';

export default function WisdomPage() {
    const { currentUser, userData, loading } = useAuth();
    const [posts, setPosts] = useState([]);

    const isAdmin = currentUser?.uid === process.env.NEXT_PUBLIC_ADMIN_FIREBASE_UID;
    const isSubscribed = userData?.isSubscribed;
    
    // Fetch posts in real-time
    useEffect(() => {
        const postsCol = collection(db, "wisdom_posts");
        const q = query(postsCol, orderBy("createdAt", "desc"));

        const unsubscribe = onSnapshot(q, (snapshot) => {
            const fetchedPosts = snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data()
            }));
            setPosts(fetchedPosts);
        }, (error) => {
            console.error("Error fetching wisdom posts:", error);
        });

        return () => unsubscribe();
    }, []);

    // Filter posts based on user access
    const filteredPosts = posts.filter(post => {
        // Admins see everything
        if (isAdmin) return true;
        // Free posts are always visible
        if (post.access === 'free') return true;
        // Premium posts require subscription
        if (post.access === 'premium' && isSubscribed) return true;
        
        return false;
    });

    if (loading) {
        return <div className="text-center py-20 text-text-muted">Loading Wisdom Library...</div>;
    }

    return (
        <div className="container mx-auto p-8 max-w-4xl">
            <h1 className="text-4xl font-serif font-bold text-brand-primary mb-2">
                The Yogi&apos;s Wisdom
            </h1>
            <p className="text-lg text-text-muted mb-8">
                Daily insights, practice tips, and philosophical reflections.
            </p>

            {isAdmin && (
                <div className="mb-8">
                    <AdminPanel currentUser={currentUser} />
                </div>
            )}

            <div className="space-y-6">
                {filteredPosts.length > 0 ? (
                    filteredPosts.map(post => (
                        <PostCard 
                            key={post.id} 
                            post={post} 
                            isSubscribed={isSubscribed}
                            isAdmin={isAdmin}
                        />
                    ))
                ) : (
                    <div className="p-8 bg-surface-2 rounded-lg text-center text-text-muted">
                        No wisdom posts available yet.
                    </div>
                )}
            </div>

            {!isSubscribed && posts.some(p => p.access === 'premium') && (
                <div className="mt-10 p-8 text-center bg-brand-accent/10 border-l-4 border-brand-accent rounded-lg">
                    <p className="text-xl font-semibold text-brand-accent mb-4">Unlock Premium Wisdom</p>
                    <p className="text-text-base mb-4">
                        Subscribe to gain exclusive access to deep-dive articles and masterclass videos reserved only for paid members.
                    </p>
                    <Link href="/pricing" className="bg-brand-accent text-white py-2 px-6 rounded-full hover:bg-brand-accent-darker transition">
                        View Subscription Plans
                    </Link>
                </div>
            )}
        </div>
    );
}

const PostCard = ({ post, isSubscribed, isAdmin }) => {
    const isPremium = post.access === 'premium';
    const isLocked = isPremium && !isSubscribed && !isAdmin;
    
    // Style adjustments for locked content
    const cardClass = isLocked ? 'opacity-50 blur-sm' : 'hover:shadow-xl';
    
    return (
        <div className={`p-6 bg-surface-1 rounded-lg shadow-md border-l-4 ${isPremium ? 'border-brand-accent' : 'border-status-success'} transition duration-300 ${cardClass}`}>
            <div className="flex justify-between items-start mb-2">
                <h2 className="text-2xl font-serif font-bold text-text-base">{post.title}</h2>
                <span className={`text-xs font-semibold px-3 py-1 rounded-full ${isPremium ? 'bg-brand-accent text-white' : 'bg-status-success text-white'}`}>
                    {isPremium ? 'Premium' : 'Free'}
                </span>
            </div>
            
            {isLocked && (
                <div className="absolute inset-0 flex items-center justify-center backdrop-blur-sm">
                    <span className="text-xl font-bold text-red-600 dark:text-red-400">Content Locked</span>
                </div>
            )}

            <p className="text-text-muted mb-4">{post.summary}</p>
            
            {!isLocked && (
                <Link href={`#post-${post.id}`} className="text-brand-primary hover:underline font-medium text-sm">
                    Read Full Post ‚Üí
                </Link>
            )}
        </div>
    );
};

--- END FILE: src\app\wisdom\page.js ---

--- START FILE: src\components\AdminPanel.js ---

// src/components/AdminPanel.js
"use client";

import { useState } from 'react';
import { db } from '@/lib/firebase';
import { collection, addDoc, serverTimestamp } from 'firebase/firestore';

export default function AdminPanel({ currentUser }) {
    const [title, setTitle] = useState('');
    const [summary, setSummary] = useState('');
    const [access, setAccess] = useState('free');
    const [status, setStatus] = useState('');
    const [isSubmitting, setIsSubmitting] = useState(false);

    if (currentUser?.uid !== process.env.NEXT_PUBLIC_ADMIN_FIREBASE_UID) {
        return null; 
    }

    const handleSubmit = async (e) => {
        e.preventDefault();
        if (!title || !summary) {
            setStatus("Title and Summary are required.");
            return;
        }

        setIsSubmitting(true);
        setStatus("Posting content...");

        try {
            await addDoc(collection(db, "wisdom_posts"), {
                title,
                summary,
                access,
                author: currentUser.displayName || 'Admin',
                createdAt: serverTimestamp(),
            });

            setStatus("Post created successfully!");
            setTitle('');
            setSummary('');
            setAccess('free');
        } catch (error) {
            console.error("Error adding document: ", error);
            setStatus(`Error: Failed to create post. ${error.message}`);
        } finally {
            setIsSubmitting(false);
        }
    };

    return (
        <div className="p-6 bg-surface-2 rounded-lg shadow-inner border border-brand-primary">
            <h2 className="text-2xl font-serif font-bold text-brand-primary mb-4">Admin Content Manager</h2>
            <form onSubmit={handleSubmit} className="space-y-4">
                <div>
                    <label htmlFor="title" className="block text-sm font-medium text-text-base">Title</label>
                    <input
                        type="text"
                        id="title"
                        value={title}
                        onChange={(e) => setTitle(e.target.value)}
                        required
                        className="w-full px-3 py-2 border rounded-md"
                    />
                </div>
                <div>
                    <label htmlFor="summary" className="block text-sm font-medium text-text-base">Summary/Content (Placeholder)</label>
                    <textarea
                        id="summary"
                        value={summary}
                        onChange={(e) => setSummary(e.target.value)}
                        rows="3"
                        required
                        className="w-full px-3 py-2 border rounded-md"
                    />
                </div>
                <div>
                    <label htmlFor="access" className="block text-sm font-medium text-text-base">Access Level</label>
                    <select
                        id="access"
                        value={access}
                        onChange={(e) => setAccess(e.target.value)}
                        className="w-full px-3 py-2 border rounded-md"
                    >
                        <option value="free">Free (All Users)</option>
                        <option value="premium">Premium (Subscribed Users Only)</option>
                    </select>
                </div>
                <button
                    type="submit"
                    className="w-full bg-brand-primary text-white py-2 rounded-lg hover:bg-brand-primary-darker disabled:opacity-50 transition"
                    disabled={isSubmitting}
                >
                    {isSubmitting ? 'Publishing...' : 'Publish Post'}
                </button>
                {status && <p className="text-sm mt-2 text-center text-status-success">{status}</p>}
            </form>
        </div>
    );
}

--- END FILE: src\components\AdminPanel.js ---

--- START FILE: src\components\AuthStatus.js ---

// src/components/AuthStatus.js (React Component in JavaScript)
"use client"; // Required for client-side components in Next.js App Router

import React, { useState, useEffect } from 'react';
import { auth } from '../lib/firebase';
import { onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from 'firebase/auth';
// FIX: CRITICAL: Import useAuth hook from the context file
import { useAuth } from '@/context/AuthContext';


// SVG Icon for Google
const GoogleIcon = () => (
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" className="w-6 h-6 mr-3">
        <path fill="#EA4335" d="M24 9.5c3.2 0 5.7 1.1 7.4 2.8l4.4-4.4C33.4 5.9 28.9 4 24 4 14.5 4 6.6 9.8 4 18.5l7.9 6.1C12.5 17.6 17.6 12 24 12c3.2 0 5.7 1.1 7.4 2.8l4.4-4.4C33.4 5.9 28.9 4 24 4z"/>
        <path fill="#4285F4" d="M46.7 24c0-1.6-.2-3.3-.5-4.8H24v9.5h12.9c-.6 3.4-2.7 6.2-5.7 8.3l7.9 6.1C44.7 39.2 48 31.9 48 24z"/>
        <path fill="#FBBC05" d="M11.9 24.1c0-.9.2-1.8.4-2.6l-7.9-6.1c-1.3 2.6-2.1 5.6-2.1 8.7s.8 6.1 2.1 8.7l7.9-6.1c-.2-.8-.4-1.7-.4-2.6z"/>
        <path fill="#34A853" d="M24 44c6.3 0 11.6-2.1 15.5-5.8l-7.9-6.1c-2.4 1.7-5.5 2.7-8.6 2.7-7.4 0-13.6-4.9-15.8-11.6l-7.9 6.1C6.6 38.2 14.5 44 24 44z"/>
    </svg>
);


const provider = new GoogleAuthProvider();

export default function AuthStatus() {
  // Destructure login and loading from the imported useAuth hook
  const { currentUser, login, loading } = useAuth(); 
  const [localLoading, setLocalLoading] = useState(false); // Local state for button loading

  const handleLogin = async () => {
    setLocalLoading(true);
    try {
      await login(); // Calls the context login
    } catch (error) {
      console.error("Login failed:", error.message);
      setLocalLoading(false);
    }
    // Auth context handles setting global loading/user status
  };

  const handleLogout = async () => {
    try {
      await signOut(auth);
    } catch (error) {
      console.error("Logout failed:", error.message);
    }
  };

  if (loading) {
    // If the global auth context is still loading, show a simple message
    return <div className="p-4 text-text-muted">Checking session...</div>;
  }

  return (
    <div className="p-0">
      {currentUser ? (
        <div className="space-y-4">
          <p className="text-sm text-status-success">
            Logged in as: <span className="font-semibold text-text-base">{currentUser.email}</span>
          </p>
          <button 
            onClick={handleLogout}
            className="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 shadow-md"
          >
            Sign Out
          </button>
        </div>
      ) : (
        // Redesigned Login Button using custom primary colors
        <button 
          onClick={handleLogin}
          className="w-full bg-brand-primary hover:bg-brand-primary-darker text-white font-bold py-3 rounded-lg transition duration-200 shadow-xl flex items-center justify-center disabled:opacity-70"
          disabled={localLoading}
        >
            {localLoading ? (
                <span>Logging In...</span>
            ) : (
                <>
                    <GoogleIcon />
                    <span>Login with Google</span>
                </>
            )}
        </button>
      )}
    </div>
  );
}

--- END FILE: src\components\AuthStatus.js ---

--- START FILE: src\components\CourseContent.js ---

// src/components/CourseContent.js
"use client";

import { trackLessonCompletion, getLessonStatus } from '@/lib/utils';
import { useAuth } from '@/context/AuthContext';
import Link from 'next/link';
import { useState, useMemo } from 'react'; 

// NOTE: Duplicated course data required for client-side rendering logic
const ALL_COURSES = {
    'beginners_mind': { 
        name: "Beginner's Mind (7 Days)", 
        isPremium: false,
        lessons: [
            { id: 'day1', title: 'Day 1: Anchor the Breath' }, { id: 'day2', title: 'Day 2: Body Scan Foundation' }, { id: 'day3', title: 'Day 3: Handling Distractions' },
            { id: 'day4', title: 'Day 4: Loving Kindness' }, { id: 'day5', title: 'Day 5: Short Daily Practice' }, { id: 'day6', title: 'Day 6: Posture and Alignment' },
            { id: 'day7', title: 'Day 7: The Path Forward' },
        ]
    },
    'vipassana_deep_dive': { 
        name: "Vipassana Deep Dive", 
        isPremium: true,
        lessons: [
            { id: 'intro', title: 'Introduction to Impermanence' }, { id: 'lesson1', title: 'The Sensation Map' }, { id: 'lesson2', title: 'Mindful Walking' },
            { id: 'lesson3', title: 'The 3 Jewels' }, { id: 'lesson4', title: 'Advanced Sitting' }, { id: 'lesson5', title: 'The Noble Silence' },
            { id: 'l6', title: 'Lecture 6: Equanimity' }, { id: 'l7', title: 'Lecture 7: The Eightfold Path' }, { id: 'l8', title: 'Lecture 8: Ethical Living' }, 
            { id: 'l9', title: 'Lecture 9: Deepening Concentration' }, { id: 'l10', title: 'Lecture 10: Subtle Sensations' }, { id: 'l11', title: 'Lecture 11: Dissolution' }, 
            { id: 'l12', title: 'Lecture 12: Continuous Practice' }, { id: 'l13', title: 'Lecture 13: Handling Pain' }, { id: 'l14', title: 'Lecture 14: Integrating Insight' },
            { id: 'l15', title: 'Lecture 15: Concluding Remarks' },
        ]
    },
    'hatha_flow': { 
        name: "Hatha Flow for Flexibility", 
        isPremium: true,
        lessons: [
            { id: 'week1', title: 'Sun Salutations Deep Dive' }, { id: 'week2', title: 'Hip Openers' }, { id: 'week3', title: 'Spinal Twists' },
            { id: 'week4', title: 'Inversions Prep' }, { id: 'week5', title: 'Restorative Poses' },
            { id: 'h6', title: 'Flow 6: Core Stability' }, { id: 'h7', title: 'Flow 7: Standing Poses' }, { id: 'h8', title: 'Flow 8: Backbends' }, 
            { id: 'h9', title: 'Flow 9: Balancing Act' }, { id: 'h10', title: 'Flow 10: Full Body Release' }, 
        ]
    },
    'pranayama_masterclass': {
        name: "Pranayama Masterclass", isPremium: true, lessons: Array.from({ length: 12 }, (_, i) => ({ id: `p${i+1}`, title: `Lesson ${i+1}: Technique ${i+1}`}))
    },
    'ashtanga_ultimatum': {
        name: "Ashtanga Yoga Ultimatum", isPremium: true, lessons: Array.from({ length: 20 }, (_, i) => ({ id: `a${i+1}`, title: `Week ${i+1} Flow Focus`}))
    },
    'raja_yoga_supreme': {
        name: "Raja Yoga Supreme", isPremium: true, lessons: Array.from({ length: 8 }, (_, i) => ({ id: `r${i+1}`, title: `Sutra ${i+1}: Practice Focus`}))
    },
};


export default function CourseContent({ courseId }) {
    
    // --- 1. CALL ALL HOOKS UNCONDITIONALLY AT THE TOP ---
    const { currentUser, userData, loading } = useAuth();
    const [forceRerenderKey, setForceRerenderKey] = useState(0); 

    // Fetch the course data immediately
    const course = ALL_COURSES[courseId]; 
    
    // Calculate progress (This must be done here, but simplify dependencies)
    // The forceRerenderKey is now the mechanism to trigger a recalculation when the user saves progress.
    const { completionPercentage, lessonsCompleted } = useMemo(() => {
        if (!course || !userData) {
            return { completionPercentage: 0, lessonsCompleted: 0 };
        }
        
        const completed = course.lessons.filter(lesson => getLessonStatus(userData, courseId, lesson.id)).length;
        const percentage = Math.round((completed / course.lessons.length) * 100);
        return { completionPercentage: percentage, lessonsCompleted: completed };
    }, [userData, courseId, course]); // Simplified dependencies: userData (from context), courseId (prop), course (local data)
    // ----------------------------------------------------------------------


    const hasAccess = !course.isPremium || userData?.isSubscribed;

    // --- 2. CONDITIONAL EARLY RETURNS FOLLOW ---

    if (loading) {
        return <div className="text-center py-20 text-text-muted">Loading Course Details...</div>;
    }

    if (!currentUser) {
        return (
            <div className="text-center py-20">
                <h2 className="text-3xl font-serif text-brand-primary mb-4">Login Required</h2>
                <p className="text-text-muted">Please log in to view course content and track your progress.</p>
                <Link href="/dashboard" className="mt-4 inline-block bg-brand-primary text-white py-2 px-6 rounded-full hover:bg-brand-primary-darker transition">Go to Dashboard</Link>
            </div>
        );
    }
    
    if (course.isPremium && !hasAccess) {
        return (
            <div className="text-center py-20">
                <h2 className="text-3xl font-serif font-bold text-brand-accent mb-4">Premium Content Locked</h2>
                <p className="text-text-muted">This course requires a subscription. View the free foundational course for now.</p>
                <Link href="/pricing" className="mt-4 inline-block bg-brand-accent text-white py-2 px-6 rounded-full hover:bg-brand-accent-darker transition">View Plans</Link>
            </div>
        );
    }
    
    // --- 3. INTERACTION LOGIC (Now correctly defined) ---
    const handleCompleteLesson = async (lessonId) => { 
        if (currentUser) {
             console.log(`[Client] Initiating completion track for: ${courseId}/${lessonId}`);
             
             // Await the completion of the Firebase write
             await trackLessonCompletion(currentUser.uid, courseId, lessonId);

             // **CRITICAL FIX:** Force a local state update immediately after the successful write.
             // This ensures the component re-renders quickly, pulling the updated userData 
             // from the AuthContext (which received the onSnapshot event).
             setForceRerenderKey(prev => prev + 1); 
             
             console.log("[Client] Rerender forced.");
        }
    };
    

    return (
        <div className="container mx-auto p-8 max-w-4xl">
            <h1 className="text-4xl font-serif font-bold text-brand-primary mb-2">{course.name}</h1>
            <p className="text-lg text-text-muted mb-6">{course.isPremium ? 'Premium Course' : 'Free Course'}</p>

            {/* Progress Display */}
            <div className="mb-8 p-4 bg-surface-2 rounded-lg border-l-4 border-brand-accent">
                <h3 className="text-xl font-semibold text-text-base mb-2">Your Progress: {completionPercentage}% ({lessonsCompleted} of {course.lessons.length} complete)</h3>
                <div className="w-full bg-gray-300 rounded-full h-3">
                    <div 
                        className="h-3 rounded-full bg-brand-accent transition-all duration-700"
                        style={{ width: `${completionPercentage}%` }}
                    ></div>
                </div>
            </div>

            {/* Lesson List */}
            <div className="space-y-4">
                {course.lessons.map(lesson => {
                    const isCompleted = getLessonStatus(userData, courseId, lesson.id);
                    
                    return (
                        <div key={lesson.id} className="p-4 bg-surface-1 rounded-lg shadow-md flex justify-between items-center border border-gray-100">
                            <span className={`text-lg font-medium ${isCompleted ? 'text-status-success' : 'text-text-base'}`}>
                                {isCompleted ? '‚úì ' : '‚Ä¢ '} {lesson.title}
                            </span>
                            <button
                                onClick={() => handleCompleteLesson(lesson.id)}
                                disabled={isCompleted}
                                className={`text-sm py-1 px-3 rounded-full transition ${
                                    isCompleted 
                                        ? 'bg-status-success text-white opacity-70 cursor-not-allowed' 
                                        : 'bg-brand-primary text-white hover:bg-brand-primary-darker'
                                }`}
                            >
                                {isCompleted ? 'Completed' : 'Mark Complete'}
                            </button>
                        </div>
                    );
                })}
            </div>
        </div>
    );
}

--- END FILE: src\components\CourseContent.js ---

--- START FILE: src\components\Footer.js ---

// src/components/Footer.js
import Link from 'next/link';

export default function Footer() {
  return (
    // Used deep gray background but maintained teal border (brand color)
    <footer className="bg-gray-900 text-white mt-8 border-t-4 border-teal-600">
      <div className="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center">
        <p>&copy; {new Date().getFullYear()} AnandaYog Meditation Centre. All rights reserved.</p>
        <div className="mt-4 space-x-4">
          <Link href="/policy" className="hover:text-teal-400 transition">Privacy Policy</Link>
          <Link href="/terms" className="hover:text-teal-400 transition">Terms of Service</Link>
        </div>
      </div>
    </footer>
  );
}

--- END FILE: src\components\Footer.js ---

--- START FILE: src\components\GitaReader.js ---

// src/components/GitaReader.js
"use client";

import { useState, useEffect, useCallback } from 'react';
import { useAuth } from '@/context/AuthContext';
import { doc, setDoc } from 'firebase/firestore';
import { db } from '@/lib/firebase';
import Image from 'next/image';
import dynamic from 'next/dynamic'; // Import dynamic

/* 
 * CRITICAL FIX: Dynamically import the viewer component.
 * This component will now handle setting the worker source and reporting the page count.
 */
const PDFViewerWrapper = dynamic(
    () => import('./RealPDFViewer'), 
    { ssr: false } 
);


// Map language codes to their paths (REMOVED hardcoded numPages)
const contentMap = {
    en: { path: '/gita_en.pdf', name: 'English' }, 
    hi: { path: '/gita_hi.pdf', name: 'Hindi' },
    bn: { path: '/gita_bn.pdf', name: 'Bengali' },
};

export default function GitaReader() {
    const { currentUser, userData, loading } = useAuth();
    const [selectedLang, setSelectedLang] = useState('en');
    const [pageNumber, setPageNumber] = useState(1);
    const [bookmarks, setBookmarks] = useState([]);
    // State to track if the initial Firestore data has been synchronized
    const [isInitialized, setIsInitialized] = useState(false);
    
    // NEW STATE: Holds the real page count loaded by react-pdf
    const [realNumPages, setRealNumPages] = useState(0); 
    
    // Derived state
    const currentFile = contentMap[selectedLang];
    const numPages = realNumPages; // Use the real number here

    // --- Persistence Handler (Fixed Bookmark Logic) ---
    const updateProgress = useCallback(async (page, lang, isBookmarkToggle = false) => {
        if (!currentUser) return;
        const userRef = doc(db, "users", currentUser.uid);
        const updateData = {};

        // Use the current local state of bookmarks for immediate UI feedback
        let currentBookmarks = isBookmarkToggle ? bookmarks : userData?.gita_progress?.bookmarks || [];

        if (isBookmarkToggle) {
            let newBookmarks = [...currentBookmarks];
            const pageIndex = page;

            if (newBookmarks.includes(pageIndex)) {
                newBookmarks = newBookmarks.filter(b => b !== pageIndex);
            } else {
                newBookmarks.push(pageIndex);
            }
            newBookmarks = Array.from(new Set(newBookmarks)).sort((a, b) => a - b);
            
            updateData['gita_progress.bookmarks'] = newBookmarks;
            setBookmarks(newBookmarks); // Update local state immediately

        } else {
            updateData['gita_progress.language'] = lang;
            updateData['gita_progress.lastPage'] = page;
        }

        try {
            await setDoc(userRef, updateData, { merge: true });
        } catch (e) {
            console.error("Error saving progress/bookmark:", e);
        }
    }, [currentUser, userData, bookmarks]); // Added bookmarks to dependencies

    // --- Handler for Page Count received from PDFViewerWrapper ---
    const handleDocumentLoadSuccess = useCallback((count) => {
        setRealNumPages(count);
        
        // Ensure the current page is valid for the newly loaded PDF
        setPageNumber(p => Math.max(1, Math.min(p, count))); 

    }, []); 


    // --- Effect: Load Synchronization State (Initial Load - Fixed sequence) ---
    useEffect(() => {
        if (loading || isInitialized) {
            return;
        }

        const initializeState = (user, data) => {
            if (user && data) {
                const progress = data?.gita_progress;
                
                const savedLang = progress?.language || 'en';
                const savedPage = progress?.lastPage || 1; 

                // Set initial state from Firestore
                setSelectedLang(savedLang);
                setBookmarks(progress?.bookmarks || []);
                setPageNumber(savedPage); 
                
            } else {
                setSelectedLang('en');
                setPageNumber(1);
                setBookmarks([]);
            }
            
            setIsInitialized(true); 
        };
        
        initializeState(currentUser, userData);
        
    }, [loading, currentUser, userData, isInitialized]); 


    // --- Debounced Tracking of Current Page ---
    useEffect(() => {
        if (currentUser && !loading && numPages > 0 && isInitialized) { 
            if (pageNumber >= 1 && pageNumber <= numPages) {
                const timeout = setTimeout(() => {
                    updateProgress(pageNumber, selectedLang, false);
                }, 1000); 
                return () => clearTimeout(timeout);
            }
        }
    }, [pageNumber, selectedLang, currentUser, loading, numPages, updateProgress, isInitialized]); 
    
    
    // --- FIX: Handler: Language Change ---
    const handleLanguageChange = (e) => {
        const newLang = e.target.value;
        if (newLang !== selectedLang) {
            setSelectedLang(newLang);
            setPageNumber(1); 
            setBookmarks([]);
            setRealNumPages(0); // Reset page count until new PDF loads
        }
    };
    // -----------------------------------------------------------


    const nextPage = () => setPageNumber(p => Math.min(p + 1, numPages));
    const prevPage = () => setPageNumber(p => Math.max(p - 1, 1));
    
    const toggleBookmark = () => {
        if (currentUser) {
            updateProgress(pageNumber, selectedLang, true);
        }
    };
    
    const isBookmarked = bookmarks.includes(pageNumber);

    if (loading || !isInitialized) {
        return <div className="text-center py-20 text-text-muted">Loading Bhagavad Gita reader...</div>;
    }

    const isReady = numPages > 0; 

    return (
        <div className="p-8 max-w-5xl mx-auto">
            <div className="flex justify-between items-center mb-6">
                <h1 className="text-3xl font-serif font-bold text-brand-primary">
                    The Bhagavad Gita Reader
                </h1>
                <select 
                    onChange={handleLanguageChange} // Referenced here!
                    value={selectedLang}
                    className="p-2 border border-gray-300 rounded-lg bg-surface-1 text-text-base"
                >
                    {Object.keys(contentMap).map(key => (
                        <option key={key} value={key}>{contentMap[key].name}</option>
                    ))}
                </select>
            </div>

            {/* Book Display Area */}
            <div className={`bg-surface-1 p-4 rounded-xl shadow-2xl border-t-4 border-brand-primary flex flex-col items-center transition-transform duration-500`}>
                
                {/* PDF Viewer Component */}
                <PDFViewerWrapper
                    file={currentFile}
                    pageNumber={pageNumber}
                    onDocumentLoadSuccess={handleDocumentLoadSuccess} // Pass the new handler
                />

                {/* Footer and Controls */}
                {isReady && ( 
                    <div className="mt-6 pt-4 w-full flex flex-wrap justify-between items-center gap-3">
                        
                        {/* Pagination */}
                        <div className="text-base font-semibold text-text-base">
                            Page {pageNumber} of {numPages}
                        </div>

                        {/* Controls */}
                        <div className="flex items-center space-x-3">
                            <button 
                                onClick={prevPage}
                                disabled={pageNumber <= 1}
                                className="px-4 py-2 bg-surface-2 text-text-base rounded-lg hover:bg-gray-300 transition disabled:opacity-50"
                            >
                                ‚Üê Previous Page
                            </button>

                            {/* Bookmark Button */}
                            <button
                                onClick={toggleBookmark}
                                className={`px-3 py-2 rounded-full transition font-semibold ${
                                    isBookmarked ? 'bg-brand-accent text-white shadow-md' : 'bg-surface-2 text-text-base hover:bg-brand-accent hover:text-white'
                                }`}
                                disabled={!currentUser}
                            >
                                {isBookmarked ? '‚òÖ Bookmarked' : '‚òÜ Bookmark Page'}
                            </button>
                            
                            <button 
                                onClick={nextPage}
                                disabled={pageNumber >= numPages}
                                className="px-4 py-2 bg-brand-primary text-white rounded-lg hover:bg-brand-primary-darker transition disabled:opacity-50"
                            >
                                Next Page ‚Üí
                            </button>
                        </div>
                    </div>
                )} 
                
                {!isReady && (
                    <p className='mt-4 text-text-muted'>Initializing PDF Viewer...</p>
                )}
                
                {currentUser && bookmarks.length > 0 && (
                    <div className="mt-4 text-sm text-text-muted text-right border-t border-gray-100 pt-2 w-full">
                        <span className='font-semibold mr-2'>Saved Bookmarks:</span>
                        {bookmarks.map(b => (
                            <button 
                                key={b} 
                                onClick={() => setPageNumber(b)}
                                className={`mx-1 px-3 py-1 rounded-full text-xs transition ${pageNumber === b ? 'bg-brand-accent text-white shadow-inner' : 'bg-brand-primary-light text-brand-primary hover:bg-brand-accent-darker hover:text-white'}`}
                            >
                                Page {b}
                            </button>
                        ))}
                    </div>
                )}
                {!currentUser && <p className='text-xs text-text-muted text-center pt-2'>Login to save your reading progress and bookmarks.</p>}
            </div>
        </div>
    );
}

--- END FILE: src\components\GitaReader.js ---

--- START FILE: src\components\Header.js ---

// src/components/Header.js
"use client";

import Link from 'next/link';
import { useState } from 'react'; 
import { useAuth } from '../context/AuthContext';

// Icons for mobile menu
const MenuIcon = ({ className = "w-6 h-6" }) => (
    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16m-7 6h7" /></svg>
);
const CloseIcon = ({ className = "w-6 h-6" }) => (
    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>
);

// Moon/Sun Icons
const SunIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
);

const MoonIcon = (props) => (
    <svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
);

// FIX: Moved ThemeToggle outside the Header component function
const ThemeToggle = () => {
  const { theme, toggleTheme } = useAuth();
  return (
    <button
        onClick={toggleTheme}
        // Refactored to use custom primary colors
        className="p-2 rounded-full text-brand-primary hover:bg-surface-2 transition"
        aria-label="Toggle Dark Mode"
    >
        {theme === 'light' ? <MoonIcon className="w-6 h-6" /> : <SunIcon className="w-6 h-6" />}
    </button>
  );
};


export default function Header() {
  const { currentUser, login, loading, userData } = useAuth(); 
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false); 
  // FIX: Use optional chaining safely
  const isSubscribed = userData?.isSubscribed;

  return (
    // Refactored background to Surface 1
    <header className="bg-surface-1 shadow-lg sticky top-0 z-50 border-b border-gray-100 dark:border-gray-700">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-20"> 
        {/* Logo/Title - Refactored text color */}
        <Link href="/" className="text-3xl font-serif font-extrabold text-brand-primary hover:text-brand-primary-darker transition tracking-tight">
          AnandaYog
        </Link>

        {/* Desktop Navigation Links */}
        <nav className="hidden md:flex space-x-8">
          <NavLink href="/teachings">What We Teach</NavLink> {/* <-- UPDATED LINK */}
          <NavLink href="/wisdom">Wisdom</NavLink> {/* <-- NEW LINK */}
          <NavLink href="/gita">Bhagavad Gita</NavLink>
          <NavLink href="/about">Our Story</NavLink>
          <NavLink href="/pricing">Pricing</NavLink>
          <NavLink href="/contact">Contact</NavLink>
        </nav>

        {/* Auth Status / Action Button (Desktop & Mobile) */}
        {/* Use flex-shrink-0 on the button group to prevent clipping */}
        <div className="flex items-center space-x-2 sm:space-x-4 flex-shrink-0">
          
          {/* Theme Toggle */}
          <ThemeToggle /> 
          
          {!loading && (
            currentUser ? (
              // If logged in, button directs to Dashboard
              <Link 
                href="/dashboard" 
                className={`text-sm sm:text-base text-white py-2 px-3 sm:px-5 rounded-full font-semibold transition duration-300 shadow-md whitespace-nowrap
                ${isSubscribed 
                    // Use status success colors if subscribed, primary if logged in but not subscribed
                    ? 'bg-status-success hover:bg-green-700' 
                    : 'bg-brand-primary hover:bg-brand-primary-darker'
                }`}
              >
                {/* FIX: Shortened text for mobile screens */}
                {isSubscribed ? 'My Access' : 'Dashboard'} 
              </Link>
            ) : (
              <button 
                onClick={login}
                // Refactored button to use primary brand color for border and hover
                className="text-sm sm:text-base text-brand-primary border-2 border-brand-primary py-2 px-3 sm:px-5 rounded-full hover:bg-surface-2 transition duration-300 font-medium shadow-sm whitespace-nowrap"
              >
                Login / Join
              </button>
            )
          )}
          
          {/* Mobile Menu Button */}
          {/* FIX: Ensure the button has space and is not clipped */}
          <button 
            onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
            className="md:hidden text-brand-primary p-2 flex-shrink-0"
            aria-label="Toggle navigation"
          >
            {isMobileMenuOpen ? <CloseIcon /> : <MenuIcon />}
          </button>
        </div>
      </div>
      
      {/* Mobile Menu Drawer - Refactored background to Surface 1 */}
      {isMobileMenuOpen && (
        <div className="md:hidden absolute w-full bg-surface-1 shadow-lg border-t border-gray-100 dark:border-gray-700 pt-2 pb-4 z-40">
            <nav className="flex flex-col space-y-2 px-4">
                <MobileNavLink href="/teachings" onClick={() => setIsMobileMenuOpen(false)}>What We Teach</MobileNavLink> {/* <-- UPDATED */}
                <MobileNavLink href="/wisdom" onClick={() => setIsMobileMenuOpen(false)}>Wisdom</MobileNavLink> {/* <-- NEW */}
                <MobileNavLink href="/gita" onClick={() => setIsMobileMenuOpen(false)}>Bhagavad Gita</MobileNavLink>
                <MobileNavLink href="/about" onClick={() => setIsMobileMenuOpen(false)}>Our Story</MobileNavLink>
                <MobileNavLink href="/pricing" onClick={() => setIsMobileMenuOpen(false)}>Pricing</MobileNavLink>
                <MobileNavLink href="/contact" onClick={() => setIsMobileMenuOpen(false)}>Contact</MobileNavLink>
            </nav>
        </div>
      )}
    </header>
  );
}

const NavLink = ({ href, children }) => (
    // Refactored hover color to primary brand
    <Link href={href} className="text-text-muted hover:text-brand-primary font-medium text-lg transition duration-200">
        {children}
    </Link>
);

const MobileNavLink = ({ href, children, onClick }) => (
    // Refactored background hover color to Surface 2
    <Link href={href} onClick={onClick} className="block px-3 py-2 text-text-base hover:bg-surface-2 rounded-md text-base font-medium">
        {children}
    </Link>
);

--- END FILE: src\components\Header.js ---

--- START FILE: src\components\PaymentInitiator.js ---

// src/components/PaymentInitiator.js (UPDATED for dynamic plans)
"use client";

import { useState } from 'react';
import { useAuth } from '../context/AuthContext';

const loadRazorpayScript = (src) => {
  return new Promise((resolve) => {
    const script = document.createElement('script');
    script.src = src;
    script.onload = () => resolve(true);
    script.onerror = () => resolve(false);
    document.body.appendChild(script);
  });
};

export default function PaymentInitiator({ planName, amount, description, isAnnual = false }) {
  const { currentUser, userData } = useAuth();
  const [status, setStatus] = useState('');
  
  if (userData?.isSubscribed && userData.subscriptionPlan === planName) {
      // Success card (using standard green for universal recognition)
      return (
        <div className="p-6 bg-green-50 border border-green-200 rounded-lg shadow-md">
            <h3 className="text-xl font-bold text-green-700 mb-2">{planName} Active!</h3>
            <p className="text-gray-600">Your current plan is active. Enjoy your unlimited access.</p>
        </div>
      );
  }
  
  // If user is subscribed but trying to buy the other plan (e.g., currently monthly, seeing annual)
  if (userData?.isSubscribed && userData.subscriptionPlan !== planName) {
      // Warning card (using standard yellow/orange)
      return (
        <div className="p-6 bg-yellow-50 border border-yellow-200 rounded-lg shadow-md">
            <h3 className="text-xl font-bold text-yellow-700 mb-2">Upgrade/Change Plan</h3>
            <p className="text-gray-600">You must cancel your current {userData.subscriptionPlan} subscription to switch to the {planName} plan.</p>
        </div>
      );
  }

  const handleCheckout = async () => {
    if (!currentUser) {
        setStatus('Error: User not logged in.');
        return;
    }

    setStatus(`Preparing checkout for ${planName}...`);
    
    // 1. Load Razorpay script
    const loaded = await loadRazorpayScript('https://checkout.razorpay.com/v1/checkout.js');
    if (!loaded) {
      setStatus('Razorpay SDK failed to load. Check network.');
      return;
    }

    // 2. Request a secure Order ID from our Node.js API Route
    const orderDataResponse = await fetch('/api/create-order', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        amount: amount, 
        receiptId: currentUser.uid,
        planName: planName
      }),
    });
    
    if (!orderDataResponse.ok) {
        setStatus('Failed to create order on server.');
        return;
    }

    const orderData = await orderDataResponse.json();

    // 3. Configure the Razorpay Checkout
    const options = {
      key: orderData.key,
      amount: orderData.amount,
      currency: orderData.currency,
      name: "AnandaYog Subscription",
      description: `${planName} Access (${orderData.amount / 100} ${orderData.currency})`,
      order_id: orderData.id,
      
      handler: async function (response) {
        setStatus('Payment successful, securely verifying...');
        
        // 4. CRITICAL: Send response to the secure server verification endpoint
        const verificationResponse = await fetch('/api/verify-payment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                orderId: response.razorpay_order_id,
                paymentId: response.razorpay_payment_id,
                signature: response.razorpay_signature,
                userId: currentUser.uid,
                amount: amount,
                planName: planName // Send the plan name to the server
            }),
        });
        
        if (verificationResponse.ok) {
            setStatus('Subscription Activated! Welcome, Yogi.');
            // AuthContext's onSnapshot listener handles the state refresh
        } else {
            setStatus('Verification failed. Contact support with payment ID.');
        }
      },
      prefill: {
        name: currentUser.displayName,
        email: currentUser.email,
      },
      theme: {
        // Updated theme color to Deep Teal (for Razorpay popup)
        color: "#0E5B6A" 
      }
    };
    
    const rzp = new window.Razorpay(options);
    rzp.open();
    setStatus('Waiting for payment...');
  };

  // Use custom variables for buttons and borders
  const buttonColor = isAnnual ? 'bg-brand-primary hover:bg-brand-primary-darker' : 'bg-brand-accent hover:bg-brand-accent-darker';
  const borderColor = isAnnual ? 'border-brand-primary' : 'border-brand-accent';


  return (
    // Refactored background to Surface 1 and border to Primary/Accent
    <div className={`p-6 bg-surface-1 border-2 ${borderColor} rounded-lg shadow-xl flex flex-col justify-between`}>
      <div>
        <h3 className="text-xl font-bold text-text-base mb-1">{planName}</h3>
        <p className="text-4xl font-extrabold text-brand-primary mb-3">‚Çπ{amount}</p>
        <p className="mb-4 text-text-muted text-sm">{description}</p>
      </div>
      
      <button 
        onClick={handleCheckout}
        disabled={status.includes('Preparing') || status.includes('Verifying') || status.includes('Waiting')}
        className={`text-white py-3 px-8 rounded-full text-lg font-semibold transition duration-300 disabled:opacity-50 shadow-md ${buttonColor}`}
      >
        {status.includes('Waiting') ? 'Payment Window Open...' : `Purchase Plan (‚Çπ${amount})`}
      </button>

      {status && <p className={`mt-4 text-sm ${status.includes('Activated') ? 'text-status-success font-medium' : 'text-text-muted'}`}>{status}</p>}
    </div>
  );
}

--- END FILE: src\components\PaymentInitiator.js ---

--- START FILE: src\components\ProtectedRoute.js ---

// src/components/ProtectedRoute.js
"use client";

import { useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useAuth } from '../context/AuthContext';

// Wraps the content of a page that requires authentication
export default function ProtectedRoute({ children }) {
  const { currentUser, loading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!loading && !currentUser) {
      // If not loading and no user is found, redirect to the home page
      router.push('/');
    }
  }, [currentUser, loading, router]);

  if (loading || !currentUser) {
    // Show a loading screen while checking status
    return (
      <div className="flex justify-center items-center h-96">
        <p className="text-xl text-gray-500">Accessing secure content...</p>
      </div>
    );
  }

  // If authenticated, render the children (the actual page content)
  return children;
}

--- END FILE: src\components\ProtectedRoute.js ---

--- START FILE: src\components\RealPDFViewer.js ---

// src/components/RealPDFViewer.js
"use client";

import { Document, Page, pdfjs } from 'react-pdf';

/* --- CRITICAL FIXES: CSS Imports --- */
// NOTE: You MUST manually copy the following CSS files from 
// node_modules/react-pdf/dist/esm/Page/ into src/styles/pdf/
import '@/styles/pdf/AnnotationLayer.css'; 
import '@/styles/pdf/TextLayer.css';      

import { useState, useMemo } from 'react';

/* --- CRITICAL FIX: Worker Source Configuration --- */
// Use the version exposed by react-pdf to ensure worker synchronization.
// This resolves the "No workerSrc specified" and version mismatch errors.
const PDFJS_VERSION = pdfjs.version;
pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${PDFJS_VERSION}/build/pdf.worker.min.mjs`;


export default function RealPDFViewer({ file, pageNumber, onDocumentLoadSuccess }) {
    
    const [containerWidth, setContainerWidth] = useState(null);
    const [isLoading, setIsLoading] = useState(true); 

    // FIX: Ensure containerRef is declared before use (fixes ReferenceError)
    const containerRef = useMemo(() => (el) => {
        if (el) {
            // Use ResizeObserver for responsive updates if necessary, 
            // but simple client rect width on mount is usually sufficient
            setContainerWidth(el.getBoundingClientRect().width);
        }
    }, []);

    // Load handler (now passes the real page count back to GitaReader)
    function onDocumentLoad({ numPages: nextNumPages }) {
        if (onDocumentLoadSuccess) {
            onDocumentLoadSuccess(nextNumPages); // Pass real count to parent
        }
        setIsLoading(false); // Document structure is loaded
    }

    // Custom Loading Component for better UX
    const LoadingComponent = (
        <div style={{ height: '600px', width: '100%', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', backgroundColor: 'rgb(var(--bg-surface-1))' }}>
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-brand-primary"></div>
            <p className="mt-4 text-brand-primary">
                Loading Bhagavad Gita ({file.name}). Document Initialization in Progress...
            </p>
        </div>
    );
    
    // Determine max page width for rendering
    // We aim for max readability (800px) or fit the container if it's smaller.
    const maxWidth = containerWidth ? Math.min(containerWidth - 32, 800) : undefined; // Subtract padding/margin

    return (
        // REMOVED FIXED HEIGHT: Allow natural PDF height to dictate vertical size.
        <div ref={containerRef} className="w-full flex justify-center py-4" style={{ minHeight: '600px' }}>
            <Document
                file={file.path} 
                onLoadSuccess={onDocumentLoad}
                loading={LoadingComponent} 
                error={<div className="text-red-500 p-8">Failed to load PDF file. Please ensure the file exists.</div>}
            >
                {/* Only render the Page component if the document structure is loaded */}
                {!isLoading && (
                    <Page 
                        pageNumber={pageNumber} 
                        // Set width to control the zoom/scale
                        width={maxWidth}
                        renderTextLayer={true} 
                        renderAnnotationLayer={true}
                    />
                )}
            </Document>
        </div>
    );
}

--- END FILE: src\components\RealPDFViewer.js ---

--- START FILE: src\components\ThemeInitializer.js ---

// src/components/ThemeInitializer.js
"use client";

import { useAuth } from '@/context/AuthContext';
import { useEffect } from 'react';

export default function ThemeInitializer() {
    const { theme, loading } = useAuth();

    useEffect(() => {
        // Only run when theme data is available (i.e., not loading)
        if (!loading && theme) {
            const root = window.document.documentElement;
            
            // 1. Remove both theme classes
            root.classList.remove('light', 'dark');
            
            // 2. Apply the current theme class
            root.classList.add(theme);

            // Debugging confirmation (optional)
            console.log(`ThemeInitializer: Applying theme class "${theme}"`);
        }
    }, [theme, loading]);

    return null; 
}

--- END FILE: src\components\ThemeInitializer.js ---

--- START FILE: src\context\AuthContext.js ---

// src/context/AuthContext.js (Cleanest and most robust version)
"use client";

import React, { createContext, useContext, useState, useEffect } from 'react';
import { auth, db } from '../lib/firebase'; 
import { onAuthStateChanged, signOut, signInWithPopup, GoogleAuthProvider } from 'firebase/auth';
import { doc, onSnapshot, setDoc } from 'firebase/firestore'; 

const AuthContext = createContext();

export const useAuth = () => useContext(AuthContext);

// FIX: Modified to enforce 'light' as the strict default if no preference is saved locally.
const getInitialTheme = () => {
    if (typeof window !== 'undefined') {
        const localTheme = localStorage.getItem('theme');
        if (localTheme) return localTheme;
        
        // New logic: If no local theme is found, we do NOT check system preference 
        // to strictly enforce the 'light' default until the user toggles it.
    }
    return 'light'; // Strict Default (Light Mode)
};

// CRITICAL: Define Admin UID from ENV variable
const ADMIN_UID = process.env.NEXT_PUBLIC_ADMIN_FIREBASE_UID;


export const AuthProvider = ({ children }) => {
  const [currentUser, setCurrentUser] = useState(null);
  const [userData, setUserData] = useState(null); 
  const [loading, setLoading] = useState(true);
  
  // Initialize theme using the function for unauthenticated state
  const [theme, setTheme] = useState(getInitialTheme); 
  
  // State for Admin status
  const [isAdmin, setIsAdmin] = useState(false);

  const googleProvider = new GoogleAuthProvider();
  const login = () => signInWithPopup(auth, googleProvider);
  const logout = () => signOut(auth);

  // Function to toggle and persist the theme
  const toggleTheme = async () => {
    const newTheme = theme === 'light' ? 'dark' : 'light';
    setTheme(newTheme); // Apply instantly to local state

    if (currentUser) {
      // 1. Logged in: Save to Firestore (creates doc if it doesn't exist)
      try {
        const userRef = doc(db, "users", currentUser.uid);
        await setDoc(userRef, { theme: newTheme }, { merge: true });
        console.log("Theme saved to Firestore.");
        localStorage.removeItem('theme'); // Clear local pref once Firestore owns it
      } catch (e) {
        console.error("Error saving theme to Firestore:", e);
      }
    } else {
      // 2. Not logged in: Save to Local Storage
      localStorage.setItem('theme', newTheme);
      console.log("Theme saved to Local Storage.");
    }
  };

  useEffect(() => {
    let unsubscribeAuth;
    let unsubscribeFirestore;

    unsubscribeAuth = onAuthStateChanged(auth, async (user) => {
      setCurrentUser(user);
      setLoading(false);
      
      // Set Admin Status based on the logged-in user
      setIsAdmin(!!user && user.uid === ADMIN_UID);

      if (user) {
        // --- LOGGED IN ---
        const userRef = doc(db, "users", user.uid);
        
        unsubscribeFirestore = onSnapshot(userRef, (docSnap) => {
            if (docSnap.exists()) {
                const rawData = docSnap.data();
                
                // --- CRITICAL FIX: Calculate Dynamic Subscription Status ---
                let isSubscribed = rawData.isSubscribed || false;
                if (rawData.subscriptionExpires) {
                    const expiryDate = new Date(rawData.subscriptionExpires);
                    const now = new Date();
                    // If isSubscribed is true but the date has passed, flip the flag
                    if (isSubscribed && expiryDate <= now) {
                        isSubscribed = false; 
                    }
                }
                
                // Store the calculated status in the data object passed to the context
                const data = { ...rawData, isSubscribed }; 
                setUserData(data);
                // -----------------------------------------------------------

                
                // Priority 1: Use theme from Firestore
                if (data.theme) {
                    setTheme(data.theme);
                } else {
                    // Priority 2: Use theme from local storage if existing user document lacks theme
                    const localTheme = localStorage.getItem('theme');
                    if (localTheme) {
                        setTheme(localTheme);
                        // Persist local preference to Firestore
                        setDoc(userRef, { theme: localTheme }, { merge: true });
                    } else {
                         // Fallback to light mode if neither Firestore nor local storage has a preference
                         setTheme('light'); 
                    }
                }
            } else {
                // --- NEW USER / FIRST LOGIN ---
                setUserData({ isSubscribed: false });
                const initialTheme = getInitialTheme(); // Will be 'light' or saved local pref
                setTheme(initialTheme);
                
                // Create document and set initial theme preference
                setDoc(userRef, { theme: initialTheme, isSubscribed: false }, { merge: true });
            }
        }, (error) => {
            console.error("Error listening to Firestore:", error);
            setUserData({ isSubscribed: false });
        });
      } else {
          // --- LOGGED OUT ---
          setUserData(null);
          // Set theme based on local storage / system preference (now simplified to only check local storage)
          setTheme(getInitialTheme());
      }
    });

    // Cleanup function
    return () => {
        if (unsubscribeAuth) unsubscribeAuth();
        if (unsubscribeFirestore) unsubscribeFirestore();
    };
  }, []); 


  const value = {
    currentUser,
    userData, 
    loading,
    login,
    logout,
    theme,           
    toggleTheme,     
    isAdmin, // <-- Added isAdmin
  };

  return (
    <AuthContext.Provider value={value}>
      {!loading && children} 
    </AuthContext.Provider>
  );
};

--- END FILE: src\context\AuthContext.js ---

--- START FILE: src\lib\firebase.js ---

// src/lib/firebase.js

import { initializeApp } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID
};

const app = initializeApp(firebaseConfig);

export const auth = getAuth(app);
export const db = getFirestore(app);

--- END FILE: src\lib\firebase.js ---

--- START FILE: src\lib\utils.js ---

// src/lib/utils.js
import { db } from './firebase';
import { doc, setDoc } from 'firebase/firestore';

/**
 * Updates the user's course progress in Firestore.
 * @param {string} userId - The Firebase User ID.
 * @param {string} courseId - The ID of the course.
 * @param {string} lessonId - The ID of the lesson completed.
 */
export const trackLessonCompletion = async (userId, courseId, lessonId) => {
    if (!userId || !courseId || !lessonId) {
        console.error("Progress tracking failed: Missing User/Course/Lesson ID.");
        return;
    }

    const userRef = doc(db, "users", userId);
    
    // Structure: users/{userId}/progress/{courseId}
    const progressUpdate = {
        [`progress.${courseId}.${lessonId}.completed`]: true,
        [`progress.${courseId}.${lessonId}.completedAt`]: new Date().toISOString(),
        [`progress.${courseId}.lastAccessed`]: new Date().toISOString(),
    };

    try {
        console.log(`[Firestore] Attempting write for user: ${userId}, course: ${courseId}`);
        
        await setDoc(userRef, progressUpdate, { merge: true });
        
        // --- SUCCESS LOG ---
        console.log(`[Firestore] SUCCESS: Progress tracked for user ${userId}: ${courseId}/${lessonId}`);
    } catch (e) {
        // --- FAILURE LOG ---
        // This will now capture and display any connection or permission failures.
        console.error("[Firestore] FATAL ERROR tracking progress:", e);
    }
};

/**
 * Gets the completion status of a specific lesson.
 */
export const getLessonStatus = (userData, courseId, lessonId) => {
    // Check if progress map exists, then course ID, then lesson ID, then completed status
    return userData?.progress?.[courseId]?.[lessonId]?.completed || false;
};

--- END FILE: src\lib\utils.js ---

-----------------------------------------------------

Let the admin be able to add posts in the Wisdom page, and edit posts, delete posts, and also let the admin add links in their posts, and also photos in their blog posts. So that, and what admin will also be able to do is update the progress of the users or the enrolled participants, so that, and also write remarks on their account, which they will be able to see if the admin has to say something to some of the users, then the admin can communicate through the remarks on notes placed in their personal dashboard. So yeah, the admin will be able to see what people are enrolled in the program, and the admin will be able to enroll people into certain programs, and that will be shown in the user's dashboard. The admin will be able to see who have active subscriptions, and who haven't, who are free members, and who aren't. And one more thing is that, in the what we teach section, I see that under our course methodology, there I saw that you tried to bold three points, but they were not bolded. I can see the stars right beside the point headings, like foundational courses, deep dive modules, progress tracking. These things should be taken care of. And I think within the dashboard, within the user's dashboard, there should be, please can you remove your course library, or you can keep it there, but each user's course library will be managed by the admin, and for the admin, make a specialized admin panel where the admin will be able to handle, control everything inside the website, and in case of the blog posts again, hear me out again, the blog posts will be about anything, the admin should be able to post anything, each and every kind of content there. Yeah, that's it. And yeah, the admin will be able to up or down the progress bar of each and every participant. For the admin view, there will be a lot, lot, lot, lot more controls there, so yeah, keep that in mind, and make a specified specialized admin dashboard there, which will be separate from the, yeah, and the admin will also be able to preview as what the normal user will be able to see, and yeah, the admin should be able to preview what a premium subscriber is able to see, and what a free user is able to see, yeah, that as well. I want all these features to be implemented, and after implementing all these features, can you please send me the updated codes and the proper guidance along with it, so I can set it up, test it myself, and deploy it finally. Thanks a lot.
